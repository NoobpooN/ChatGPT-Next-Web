(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[683],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},7403:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ComponentMod:()=>O,default:()=>$});var r={};a.r(r),a.d(r,{GET:()=>g,POST:()=>w,preferredRegion:()=>x,runtime:()=>_});var o={};a.r(o),a.d(o,{headerHooks:()=>S,originalPathname:()=>R,patchFetch:()=>v,requestAsyncStorage:()=>E,routeModule:()=>T,serverHooks:()=>P,staticGenerationAsyncStorage:()=>A,staticGenerationBailout:()=>B});var n=a(7875),s=a(8381),i=a(2251),u=a(9845),d=a(9579),l=a(7736),c=a(1480),p=a(572),h=a(5577),f=a(413);async function b(e,t){let a=await fetch(`${l.FR}?grant_type=client_credentials&client_id=${e}&client_secret=${t}`,{method:"POST",mode:"cors"});return await a.json()}let m=(0,d.g)();async function y(e,{params:t}){if(console.log("[Baidu Route] params ",t),"OPTIONS"===e.method)return p.xk.json({body:"OK"},{status:200});let a=(0,h.I)(e,l.k8.Ernie);if(a.error)return p.xk.json(a,{status:401});if(!m.baiduApiKey||!m.baiduSecretKey)return p.xk.json({error:!0,message:"missing BAIDU_API_KEY or BAIDU_SECRET_KEY in server env vars"},{status:401});try{return await k(e)}catch(e){return console.error("[Baidu] ",e),p.xk.json((0,c.B)(e))}}let g=y,w=y,_="edge",x=["arn1","bom1","cdg1","cle1","cpt1","dub1","fra1","gru1","hnd1","iad1","icn1","kix1","lhr1","pdx1","sfo1","sin1","syd1"];async function k(e){let t=new AbortController,a=`${e.nextUrl.pathname}`.replaceAll(l.L.Baidu,""),r=m.baiduUrl||l.n9;r.startsWith("http")||(r=`https://${r}`),r.endsWith("/")&&(r=r.slice(0,-1)),console.log("[Proxy] ",a),console.log("[Base Url]",r);let o=setTimeout(()=>{t.abort()},6e5),{access_token:n}=await b(m.baiduApiKey,m.baiduSecretKey),s=`${r}${a}?access_token=${n}`,i={headers:{"Content-Type":"application/json"},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(m.customModels&&e.body)try{let t=await e.text();i.body=t;let a=JSON.parse(t);if((0,f.pw)(m.customModels,a?.model,l.UT.Baidu))return p.xk.json({error:!0,message:`you are not allowed to use ${a?.model} model`},{status:403})}catch(e){console.error("[Baidu] filter",e)}try{let e=await fetch(s,i),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(o)}}let T=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/baidu/[...path]/route",pathname:"/api/baidu/[...path]",filename:"route",bundlePath:"app/api/baidu/[...path]/route"},resolvedPagePath:"/Volumes/D/github/ChatGPT-Next-Web/app/api/baidu/[...path]/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:E,staticGenerationAsyncStorage:A,serverHooks:P,headerHooks:S,staticGenerationBailout:B}=T,R="/api/baidu/[...path]/route";function v(){return(0,u.XH)({serverHooks:P,staticGenerationAsyncStorage:A})}let O=o,$=n.a.wrap(T)}},e=>{var t=t=>e(e.s=t);e.O(0,[297,45,744],()=>t(7403));var a=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/baidu/[...path]/route"]=a}]);
//# sourceMappingURL=route.js.map