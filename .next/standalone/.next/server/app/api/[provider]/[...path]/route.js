(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[919],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},3262:(e,t,o)=>{"use strict";o.r(t),o.d(t,{ComponentMod:()=>ec,default:()=>ed});var r={};o.r(r),o.d(r,{GET:()=>Q,POST:()=>Z,preferredRegion:()=>et,runtime:()=>ee});var a={};o.r(a),o.d(a,{headerHooks:()=>en,originalPathname:()=>ei,patchFetch:()=>eu,requestAsyncStorage:()=>er,routeModule:()=>eo,serverHooks:()=>es,staticGenerationAsyncStorage:()=>ea,staticGenerationBailout:()=>el});var s=o(7875),n=o(8381),l=o(2251),i=o(9845),u=o(7736),c=o(9579),d=o(1480),h=o(572),p=o(5577);let y={val:-1e3,cache:new Map,next:e=>{if(y.cache.has(e))return y.cache.get(e);{let t=y.val++;return y.cache.set(e,t),t}}},m=e=>({id:e.toLowerCase(),providerName:e,providerType:"custom",sorted:y.next(e)});function f(e,t,o){let r=`${t}@${o}`,a=function(e,t){let o={};return e.forEach(e=>{o[`${e.name}@${e?.provider?.id}`]={...e,displayName:e.name}}),t.split(",").filter(e=>!!e&&e.length>0).forEach(e=>{let t=!e.startsWith("-"),[r,a]=(e.startsWith("+")||e.startsWith("-")?e.slice(1):e).split("=");if("all"===r)Object.values(o).forEach(e=>e.available=t);else{let[e,s]=r.split("@"),n=0;for(let l in o){let[i,u]=l.split("@");e==i&&(void 0===s||s===u)&&(n+=1,o[l].available=t,"bytedance"===u&&([r,a]=[a,i],o[l].name=r),a&&(o[l].displayName=a))}if(0===n){let[e,s]=r.split("@"),n=m(s||e);a&&"ByteDance"==n.providerName&&([e,a]=[a,e]),o[`${e}@${n?.id}`]={name:e,displayName:a||e,available:t,provider:n,sorted:y.next(`${e}@${n?.id}`)}}}}),o}(u.Fv,e);return a[r]?.available===!1}function g(e){let t=e.split("/");if("gateway.ai.cloudflare.com"==t[2]){if("azure-openai"==t[6])return t.slice(0,8).concat(t.slice(-3)).join("/");if("openai"==t[6]||"anthropic"==t[6])return t.slice(0,7).concat(t.slice(-2)).join("/")}return e}let b=(0,c.g)();async function x(e){let t=new AbortController,o=e.nextUrl.pathname.includes("azure/deployments");var r,a="";o?(r=e.headers.get("Authorization")?.trim().replaceAll("Bearer ","").trim()??"",a="api-key"):(r=e.headers.get("Authorization")??"",a="Authorization");let s=`${e.nextUrl.pathname}`.replaceAll("/api/openai/",""),n=(o?b.azureUrl:b.baseUrl)||u.Bi;n.startsWith("http")||(n=`https://${n}`),n.endsWith("/")&&(n=n.slice(0,-1)),console.log("[Proxy] ",s),console.log("[Base Url]",n);let l=setTimeout(()=>{t.abort()},6e5);if(o){let t=e?.nextUrl?.searchParams?.get("api-version")||b.azureApiVersion;if(n=n.split("/deployments").shift(),s=`${e.nextUrl.pathname.replaceAll("/api/azure/","")}?api-version=${t}`,b.customModels&&b.azureUrl){let e=s.split("/")[1],t="";b.customModels.split(",").filter(t=>!!t&&!t.startsWith("-")&&t.includes(e)).forEach(e=>{let[o,r]=e.split("="),[a,s]=o.split("@");if("azure"===s&&!r){let[e,o]=(b?.azureUrl??"").split("deployments/");o&&(t=o)}}),t&&(console.log("[Replace with DeployId",t),s=s.replaceAll(e,t))}}let i=g(`${n}/${s}`);console.log("fetchUrl",i);let c={headers:{"Content-Type":"application/json","Cache-Control":"no-store",[a]:r,...b.openaiOrgId&&{"OpenAI-Organization":b.openaiOrgId}},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(b.customModels&&e.body)try{let t=await e.text();c.body=t;let o=JSON.parse(t);if(f(b.customModels,o?.model,u.UT.OpenAI)||f(b.customModels,o?.model,u.UT.Azure))return h.xk.json({error:!0,message:`you are not allowed to use ${o?.model} model`},{status:403})}catch(e){console.error("[OpenAI] gpt4 filter",e)}try{let e=await fetch(i,c),t=e.headers.get("OpenAI-Organization");b.openaiOrgId&&""!==b.openaiOrgId.trim()?console.log("[Org ID]",t):console.log("[Org ID] is not set up.");let o=new Headers(e.headers);return o.delete("www-authenticate"),o.set("X-Accel-Buffering","no"),b.openaiOrgId&&""!==b.openaiOrgId.trim()||o.delete("OpenAI-Organization"),o.delete("content-encoding"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:o})}finally{clearTimeout(l)}}let w=new Set(Object.values(u.mX));async function A(e,{params:t}){if(console.log("[OpenAI Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=t.path.join("/");if(!w.has(o))return console.log("[OpenAI Route] forbidden path ",o),h.xk.json({error:!0,msg:"you are not allowed to request "+o},{status:403});let r=(0,p.I)(e,u.k8.GPT);if(r.error)return h.xk.json(r,{status:401});try{let t=await x(e);if(o===u.mX.ListModelPath&&200===t.status){var a;let e=(a=await t.json(),(0,c.g)().disableGPT4&&(a.data=a.data.filter(e=>!(e.id.startsWith("gpt-4")||e.id.startsWith("chatgpt-4o"))||e.id.startsWith("gpt-4o-mini"))),a);return h.xk.json(e,{status:t.status})}return t}catch(e){return console.error("[OpenAI] ",e),h.xk.json((0,d.B)(e))}}async function k(e,{params:t}){if(console.log("[Azure Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});t.path.join("/");let o=(0,p.I)(e,u.k8.GPT);if(o.error)return h.xk.json(o,{status:401});try{return await x(e)}catch(e){return console.error("[Azure] ",e),h.xk.json((0,d.B)(e))}}let T=(0,c.g)();async function O(e,{params:t}){if(console.log("[Google Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=(0,p.I)(e,u.k8.GeminiPro);if(o.error)return h.xk.json(o,{status:401});let r=(e.headers.get("x-goog-api-key")||e.headers.get("Authorization")||"").trim().replaceAll("Bearer ","").trim()||T.googleApiKey;if(!r)return h.xk.json({error:!0,message:"missing GOOGLE_API_KEY in server env vars"},{status:401});try{return await j(e,r)}catch(e){return console.error("[Google] ",e),h.xk.json((0,d.B)(e))}}async function j(e,t){let o=new AbortController,r=T.googleUrl||u.Hm,a=`${e.nextUrl.pathname}`.replaceAll(u.L.Google,"");r.startsWith("http")||(r=`https://${r}`),r.endsWith("/")&&(r=r.slice(0,-1)),console.log("[Proxy] ",a),console.log("[Base Url]",r);let s=setTimeout(()=>{o.abort()},6e5),n=`${r}${a}${e?.nextUrl?.searchParams?.get("alt")==="sse"?"?alt=sse":""}`;console.log("[Fetch Url] ",n);let l={headers:{"Content-Type":"application/json","Cache-Control":"no-store","x-goog-api-key":e.headers.get("x-goog-api-key")||(e.headers.get("Authorization")??"").replace("Bearer ","")},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:o.signal};try{let e=await fetch(n,l),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(s)}}let $=new Set([u.YU.ChatPath,u.YU.ChatPath1]);async function I(e,{params:t}){if(console.log("[Anthropic Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=t.path.join("/");if(!$.has(o))return console.log("[Anthropic Route] forbidden path ",o),h.xk.json({error:!0,msg:"you are not allowed to request "+o},{status:403});let r=(0,p.I)(e,u.k8.Claude);if(r.error)return h.xk.json(r,{status:401});try{return await B(e)}catch(e){return console.error("[Anthropic] ",e),h.xk.json((0,d.B)(e))}}let U=(0,c.g)();async function B(e){let t=new AbortController,o="x-api-key",r=e.headers.get(o)||e.headers.get("Authorization")?.replaceAll("Bearer ","").trim()||U.anthropicApiKey||"",a=`${e.nextUrl.pathname}`.replaceAll(u.L.Anthropic,""),s=U.anthropicUrl||U.baseUrl||u.y3;s.startsWith("http")||(s=`https://${s}`),s.endsWith("/")&&(s=s.slice(0,-1)),console.log("[Proxy] ",a),console.log("[Base Url]",s);let n=setTimeout(()=>{t.abort()},6e5),l=g(`${s}${a}`),i={headers:{"Content-Type":"application/json","Cache-Control":"no-store","anthropic-dangerous-direct-browser-access":"true",[o]:r,"anthropic-version":e.headers.get("anthropic-version")||U.anthropicApiVersion||u.YU.Vision},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(U.customModels&&e.body)try{let t=await e.text();i.body=t;let o=JSON.parse(t);if(f(U.customModels,o?.model,u.UT.Anthropic))return h.xk.json({error:!0,message:`you are not allowed to use ${o?.model} model`},{status:403})}catch(e){console.error("[Anthropic] filter",e)}try{let e=await fetch(l,i),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(n)}}async function P(e,t){let o=await fetch(`${u.FR}?grant_type=client_credentials&client_id=${e}&client_secret=${t}`,{method:"POST",mode:"cors"});return await o.json()}let S=(0,c.g)();async function v(e,{params:t}){if(console.log("[Baidu Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=(0,p.I)(e,u.k8.Ernie);if(o.error)return h.xk.json(o,{status:401});if(!S.baiduApiKey||!S.baiduSecretKey)return h.xk.json({error:!0,message:"missing BAIDU_API_KEY or BAIDU_SECRET_KEY in server env vars"},{status:401});try{return await C(e)}catch(e){return console.error("[Baidu] ",e),h.xk.json((0,d.B)(e))}}async function C(e){let t=new AbortController,o=`${e.nextUrl.pathname}`.replaceAll(u.L.Baidu,""),r=S.baiduUrl||u.n9;r.startsWith("http")||(r=`https://${r}`),r.endsWith("/")&&(r=r.slice(0,-1)),console.log("[Proxy] ",o),console.log("[Base Url]",r);let a=setTimeout(()=>{t.abort()},6e5),{access_token:s}=await P(S.baiduApiKey,S.baiduSecretKey),n=`${r}${o}?access_token=${s}`,l={headers:{"Content-Type":"application/json"},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(S.customModels&&e.body)try{let t=await e.text();l.body=t;let o=JSON.parse(t);if(f(S.customModels,o?.model,u.UT.Baidu))return h.xk.json({error:!0,message:`you are not allowed to use ${o?.model} model`},{status:403})}catch(e){console.error("[Baidu] filter",e)}try{let e=await fetch(n,l),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(a)}}let z=(0,c.g)();async function K(e,{params:t}){if(console.log("[ByteDance Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=(0,p.I)(e,u.k8.Doubao);if(o.error)return h.xk.json(o,{status:401});try{return await R(e)}catch(e){return console.error("[ByteDance] ",e),h.xk.json((0,d.B)(e))}}async function R(e){let t=new AbortController,o=`${e.nextUrl.pathname}`.replaceAll(u.L.ByteDance,""),r=z.bytedanceUrl||u.ik;r.startsWith("http")||(r=`https://${r}`),r.endsWith("/")&&(r=r.slice(0,-1)),console.log("[Proxy] ",o),console.log("[Base Url]",r);let a=setTimeout(()=>{t.abort()},6e5),s=`${r}${o}`,n={headers:{"Content-Type":"application/json",Authorization:e.headers.get("Authorization")??""},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(z.customModels&&e.body)try{let t=await e.text();n.body=t;let o=JSON.parse(t);if(f(z.customModels,o?.model,u.UT.ByteDance))return h.xk.json({error:!0,message:`you are not allowed to use ${o?.model} model`},{status:403})}catch(e){console.error("[ByteDance] filter",e)}try{let e=await fetch(s,n),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(a)}}let M=(0,c.g)();async function N(e,{params:t}){if(console.log("[Alibaba Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=(0,p.I)(e,u.k8.Qwen);if(o.error)return h.xk.json(o,{status:401});try{return await W(e)}catch(e){return console.error("[Alibaba] ",e),h.xk.json((0,d.B)(e))}}async function W(e){let t=new AbortController,o=`${e.nextUrl.pathname}`.replaceAll(u.L.Alibaba,""),r=M.alibabaUrl||u.x5;r.startsWith("http")||(r=`https://${r}`),r.endsWith("/")&&(r=r.slice(0,-1)),console.log("[Proxy] ",o),console.log("[Base Url]",r);let a=setTimeout(()=>{t.abort()},6e5),s=`${r}${o}`,n={headers:{"Content-Type":"application/json",Authorization:e.headers.get("Authorization")??"","X-DashScope-SSE":e.headers.get("X-DashScope-SSE")??"disable"},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(M.customModels&&e.body)try{let t=await e.text();n.body=t;let o=JSON.parse(t);if(f(M.customModels,o?.model,u.UT.Alibaba))return h.xk.json({error:!0,message:`you are not allowed to use ${o?.model} model`},{status:403})}catch(e){console.error("[Alibaba] filter",e)}try{let e=await fetch(s,n),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(a)}}let E=(0,c.g)();async function L(e,{params:t}){if(console.log("[Moonshot Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=(0,p.I)(e,u.k8.Moonshot);if(o.error)return h.xk.json(o,{status:401});try{return await X(e)}catch(e){return console.error("[Moonshot] ",e),h.xk.json((0,d.B)(e))}}async function X(e){let t=new AbortController,o=`${e.nextUrl.pathname}`.replaceAll(u.L.Moonshot,""),r=E.moonshotUrl||u.bP;r.startsWith("http")||(r=`https://${r}`),r.endsWith("/")&&(r=r.slice(0,-1)),console.log("[Proxy] ",o),console.log("[Base Url]",r);let a=setTimeout(()=>{t.abort()},6e5),s=`${r}${o}`,n={headers:{"Content-Type":"application/json",Authorization:e.headers.get("Authorization")??""},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(E.customModels&&e.body)try{let t=await e.text();n.body=t;let o=JSON.parse(t);if(f(E.customModels,o?.model,u.UT.Moonshot))return h.xk.json({error:!0,message:`you are not allowed to use ${o?.model} model`},{status:403})}catch(e){console.error("[Moonshot] filter",e)}try{let e=await fetch(s,n),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(a)}}async function _(e,{params:t}){if(console.log("[Stability] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=new AbortController,r=(0,c.g)(),a=r.stabilityUrl||u.rT;a.startsWith("http")||(a=`https://${a}`),a.endsWith("/")&&(a=a.slice(0,-1));let s=`${e.nextUrl.pathname}`.replaceAll("/api/stability/","");console.log("[Stability Proxy] ",s),console.log("[Stability Base Url]",a);let n=setTimeout(()=>{o.abort()},6e5),l=(0,p.I)(e,u.k8.Stability);if(l.error)return h.xk.json(l,{status:401});let i=(e.headers.get("Authorization")??"").trim().replaceAll("Bearer ","").trim()||r.stabilityApiKey;if(!i)return h.xk.json({error:!0,message:"missing STABILITY_API_KEY in server env vars"},{status:401});let d=`${a}/${s}`;console.log("[Stability Url] ",d);let y={headers:{"Content-Type":e.headers.get("Content-Type")||"multipart/form-data",Accept:e.headers.get("Accept")||"application/json",Authorization:`Bearer ${i}`},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:o.signal};try{let e=await fetch(d,y),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(n)}}let D=(0,c.g)();async function G(e,{params:t}){if(console.log("[Iflytek Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=(0,p.I)(e,u.k8.Iflytek);if(o.error)return h.xk.json(o,{status:401});try{return await H(e)}catch(e){return console.error("[Iflytek] ",e),h.xk.json((0,d.B)(e))}}async function H(e){let t=new AbortController,o=`${e.nextUrl.pathname}`.replaceAll(u.L.Iflytek,""),r=D.iflytekUrl||u.pG;r.startsWith("http")||(r=`https://${r}`),r.endsWith("/")&&(r=r.slice(0,-1)),console.log("[Proxy] ",o),console.log("[Base Url]",r);let a=setTimeout(()=>{t.abort()},6e5),s=`${r}${o}`,n={headers:{"Content-Type":"application/json",Authorization:e.headers.get("Authorization")??""},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(D.customModels&&e.body)try{let t=await e.text();n.body=t;let o=JSON.parse(t);if(f(D.customModels,o?.model,u.UT.Iflytek))return h.xk.json({error:!0,message:`you are not allowed to use ${o?.model} model`},{status:403})}catch(e){console.error("[Iflytek] filter",e)}try{let e=await fetch(s,n),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(a)}}let J=(0,c.g)();async function Y(e,{params:t}){if(console.log("[XAI Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});let o=(0,p.I)(e,u.k8.XAI);if(o.error)return h.xk.json(o,{status:401});try{return await q(e)}catch(e){return console.error("[XAI] ",e),h.xk.json((0,d.B)(e))}}async function q(e){let t=new AbortController,o=`${e.nextUrl.pathname}`.replaceAll(u.L.XAI,""),r=J.xaiUrl||u.eE;r.startsWith("http")||(r=`https://${r}`),r.endsWith("/")&&(r=r.slice(0,-1)),console.log("[Proxy] ",o),console.log("[Base Url]",r);let a=setTimeout(()=>{t.abort()},6e5),s=`${r}${o}`,n={headers:{"Content-Type":"application/json",Authorization:e.headers.get("Authorization")??""},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(J.customModels&&e.body)try{let t=await e.text();n.body=t;let o=JSON.parse(t);if(f(J.customModels,o?.model,u.UT.XAI))return h.xk.json({error:!0,message:`you are not allowed to use ${o?.model} model`},{status:403})}catch(e){console.error("[XAI] filter",e)}try{let e=await fetch(s,n),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(a)}}async function F(e,{params:t}){if(console.log("[Proxy Route] params ",t),"OPTIONS"===e.method)return h.xk.json({body:"OK"},{status:200});e.nextUrl.searchParams.delete("path"),e.nextUrl.searchParams.delete("provider");let o=t.path.join("/"),r=`${e.headers.get("x-base-url")}/${o}?${e.nextUrl.searchParams.toString()}`,a=["connection","host","origin","referer","cookie"],s=new Headers(Array.from(e.headers.entries()).filter(e=>!(e[0].indexOf("x-")>-1||e[0].indexOf("sec-")>-1||a.includes(e[0])))),n=new AbortController,l={headers:s,method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:n.signal},i=setTimeout(()=>{n.abort()},6e5);try{let e=await fetch(r,l),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),t.delete("content-encoding"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(i)}}async function V(e,{params:t}){let o=`/api/${t.provider}`;switch(console.log(`[${t.provider} Route] params `,t),o){case u.L.Azure:return k(e,{params:t});case u.L.Google:return O(e,{params:t});case u.L.Anthropic:return I(e,{params:t});case u.L.Baidu:return v(e,{params:t});case u.L.ByteDance:return K(e,{params:t});case u.L.Alibaba:return N(e,{params:t});case u.L.Moonshot:return L(e,{params:t});case u.L.Stability:return _(e,{params:t});case u.L.Iflytek:return G(e,{params:t});case u.L.XAI:return Y(e,{params:t});case u.L.OpenAI:return A(e,{params:t});default:return F(e,{params:t})}}let Q=V,Z=V,ee="edge",et=["arn1","bom1","cdg1","cle1","cpt1","dub1","fra1","gru1","hnd1","iad1","icn1","kix1","lhr1","pdx1","sfo1","sin1","syd1"],eo=new n.AppRouteRouteModule({definition:{kind:l.x.APP_ROUTE,page:"/api/[provider]/[...path]/route",pathname:"/api/[provider]/[...path]",filename:"route",bundlePath:"app/api/[provider]/[...path]/route"},resolvedPagePath:"/Volumes/D/github/ChatGPT-Next-Web/app/api/[provider]/[...path]/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:er,staticGenerationAsyncStorage:ea,serverHooks:es,headerHooks:en,staticGenerationBailout:el}=eo,ei="/api/[provider]/[...path]/route";function eu(){return(0,i.XH)({serverHooks:es,staticGenerationAsyncStorage:ea})}let ec=a,ed=s.a.wrap(eo)},5577:(e,t,o)=>{"use strict";o.d(t,{I:()=>l});var r=o(9579),a=o(5045),s=o.n(a),n=o(7736);function l(e,t){let{accessCode:o,apiKey:a}=function(e){let t=e.trim().replaceAll("Bearer ","").trim(),o=!t.startsWith(n.TW);return{accessCode:o?"":t.slice(n.TW.length),apiKey:o?t:""}}(e.headers.get("Authorization")??""),l=s().hash(o??"").trim(),i=(0,r.g)();if(console.log("[Auth] allowed hashed codes: ",[...i.codes]),console.log("[Auth] got access code:",o),console.log("[Auth] hashed access code:",l),console.log("[User IP] ",function(e){let t=e.ip??e.headers.get("x-real-ip"),o=e.headers.get("x-forwarded-for");return!t&&o&&(t=o.split(",").at(0)??""),t}(e)),console.log("[Time] ",new Date().toLocaleString()),i.needCode&&!i.codes.has(l)&&!a)return{error:!0,msg:o?"wrong access code":"empty access code"};if(i.hideUserApiKey&&a)return{error:!0,msg:"you are not allowed to access with your own api key"};if(a)console.log("[Auth] use user api key");else{let o;let a=(0,r.g)();switch(t){case n.k8.Stability:o=a.stabilityApiKey;break;case n.k8.GeminiPro:o=a.googleApiKey;break;case n.k8.Claude:o=a.anthropicApiKey;break;case n.k8.Doubao:o=a.bytedanceApiKey;break;case n.k8.Ernie:o=a.baiduApiKey;break;case n.k8.Qwen:o=a.alibabaApiKey;break;case n.k8.Moonshot:o=a.moonshotApiKey;break;case n.k8.Iflytek:o=a.iflytekApiKey+":"+a.iflytekApiSecret;break;case n.k8.XAI:o=a.xaiApiKey;break;case n.k8.GPT:default:o=e.nextUrl.pathname.includes("azure/deployments")?a.azureApiKey:a.apiKey}o?(console.log("[Auth] use system api key"),e.headers.set("Authorization",`Bearer ${o}`)):console.log("[Auth] admin did not provide an api key")}return{error:!1}}},1480:(e,t,o)=>{"use strict";function r(e){let t=e;return("string"!=typeof e&&(e=JSON.stringify(e,null,"  ")),"{}"===e)?t.toString():e.startsWith("```json")?e:["```json",e,"```"].join("\n")}o.d(t,{B:()=>r})}},e=>{var t=t=>e(e.s=t);e.O(0,[297,45,579],()=>t(3262));var o=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/[provider]/[...path]/route"]=o}]);
//# sourceMappingURL=route.js.map