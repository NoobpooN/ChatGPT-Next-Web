{"version":3,"file":"app/api/[provider]/[...path]/route.js","mappings":"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","sources":["webpack://_N_E/external commonjs \"node:async_hooks\"","webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/./app/utils/cloudflare.ts","webpack://_N_E/./app/api/common.ts","webpack://_N_E/./app/api/openai.ts","webpack://_N_E/./app/api/azure.ts","webpack://_N_E/./app/api/google.ts","webpack://_N_E/./app/api/anthropic.ts","webpack://_N_E/./app/utils/baidu.ts","webpack://_N_E/./app/api/baidu.ts","webpack://_N_E/./app/api/bytedance.ts","webpack://_N_E/./app/api/alibaba.ts","webpack://_N_E/./app/api/moonshot.ts","webpack://_N_E/./app/api/stability.ts","webpack://_N_E/./app/api/iflytek.ts","webpack://_N_E/./app/api/deepseek.ts","webpack://_N_E/./app/api/siliconflow.ts","webpack://_N_E/./app/api/xai.ts","webpack://_N_E/./app/api/glm.ts","webpack://_N_E/./app/api/proxy.ts","webpack://_N_E/./app/api/[provider]/[...path]/route.ts","webpack://_N_E/./app/api/[provider]/[...path]/route.ts?da5f","webpack://_N_E/?ee54","webpack://_N_E/./app/api/auth.ts","webpack://_N_E/./app/utils/format.ts","webpack://_N_E/<anon>"],"sourcesContent":["module.exports = require(\"node:async_hooks\");","module.exports = require(\"node:buffer\");","export function cloudflareAIGatewayUrl(fetchUrl: string) {\n  // rebuild fetchUrl, if using cloudflare ai gateway\n  // document: https://developers.cloudflare.com/ai-gateway/providers/openai/\n\n  const paths = fetchUrl.split(\"/\");\n  if (\"gateway.ai.cloudflare.com\" == paths[2]) {\n    // is cloudflare.com ai gateway\n    // https://gateway.ai.cloudflare.com/v1/{account_id}/{gateway_id}/azure-openai/{resource_name}/{deployment_name}/chat/completions?api-version=2023-05-15'\n    if (\"azure-openai\" == paths[6]) {\n      // is azure gateway\n      return paths.slice(0, 8).concat(paths.slice(-3)).join(\"/\"); // rebuild ai gateway azure_url\n    }\n    // https://gateway.ai.cloudflare.com/v1/{account_id}/{gateway_id}/openai/chat/completions\n    if (\"openai\" == paths[6]) {\n      // is openai gateway\n      return paths.slice(0, 7).concat(paths.slice(-2)).join(\"/\"); // rebuild ai gateway openai_url\n    }\n    // https://gateway.ai.cloudflare.com/v1/{account_id}/{gateway_id}/anthropic/v1/messages \\\n    if (\"anthropic\" == paths[6]) {\n      // is anthropic gateway\n      return paths.slice(0, 7).concat(paths.slice(-2)).join(\"/\"); // rebuild ai gateway anthropic_url\n    }\n    // TODO: Amazon Bedrock, Groq, HuggingFace...\n  }\n  return fetchUrl;\n}\n","import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSideConfig } from \"../config/server\";\nimport { OPENAI_BASE_URL, ServiceProvider } from \"../constant\";\nimport { cloudflareAIGatewayUrl } from \"../utils/cloudflare\";\nimport { getModelProvider, isModelNotavailableInServer } from \"../utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function requestOpenai(req: NextRequest) {\n  const controller = new AbortController();\n\n  const isAzure = req.nextUrl.pathname.includes(\"azure/deployments\");\n\n  var authValue,\n    authHeaderName = \"\";\n  if (isAzure) {\n    authValue =\n      req.headers\n        .get(\"Authorization\")\n        ?.trim()\n        .replaceAll(\"Bearer \", \"\")\n        .trim() ?? \"\";\n\n    authHeaderName = \"api-key\";\n  } else {\n    authValue = req.headers.get(\"Authorization\") ?? \"\";\n    authHeaderName = \"Authorization\";\n  }\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(\"/api/openai/\", \"\");\n\n  let baseUrl =\n    (isAzure ? serverConfig.azureUrl : serverConfig.baseUrl) || OPENAI_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  if (isAzure) {\n    const azureApiVersion =\n      req?.nextUrl?.searchParams?.get(\"api-version\") ||\n      serverConfig.azureApiVersion;\n    baseUrl = baseUrl.split(\"/deployments\").shift() as string;\n    path = `${req.nextUrl.pathname.replaceAll(\n      \"/api/azure/\",\n      \"\",\n    )}?api-version=${azureApiVersion}`;\n\n    // Forward compatibility:\n    // if display_name(deployment_name) not set, and '{deploy-id}' in AZURE_URL\n    // then using default '{deploy-id}'\n    if (serverConfig.customModels && serverConfig.azureUrl) {\n      const modelName = path.split(\"/\")[1];\n      let realDeployName = \"\";\n      serverConfig.customModels\n        .split(\",\")\n        .filter((v) => !!v && !v.startsWith(\"-\") && v.includes(modelName))\n        .forEach((m) => {\n          const [fullName, displayName] = m.split(\"=\");\n          const [_, providerName] = getModelProvider(fullName);\n          if (providerName === \"azure\" && !displayName) {\n            const [_, deployId] = (serverConfig?.azureUrl ?? \"\").split(\n              \"deployments/\",\n            );\n            if (deployId) {\n              realDeployName = deployId;\n            }\n          }\n        });\n      if (realDeployName) {\n        console.log(\"[Replace with DeployId\", realDeployName);\n        path = path.replaceAll(modelName, realDeployName);\n      }\n    }\n  }\n\n  const fetchUrl = cloudflareAIGatewayUrl(`${baseUrl}/${path}`);\n  console.log(\"fetchUrl\", fetchUrl);\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Cache-Control\": \"no-store\",\n      [authHeaderName]: authValue,\n      ...(serverConfig.openaiOrgId && {\n        \"OpenAI-Organization\": serverConfig.openaiOrgId,\n      }),\n    },\n    method: req.method,\n    body: req.body,\n    // to fix #2485: https://stackoverflow.com/questions/55920957/cloudflare-worker-typeerror-one-time-use-body\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse gpt4 request\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          [\n            ServiceProvider.OpenAI,\n            ServiceProvider.Azure,\n            jsonBody?.model as string, // support provider-unspecified model\n          ],\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(\"[OpenAI] gpt4 filter\", e);\n    }\n  }\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // Extract the OpenAI-Organization header from the response\n    const openaiOrganizationHeader = res.headers.get(\"OpenAI-Organization\");\n\n    // Check if serverConfig.openaiOrgId is defined and not an empty string\n    if (serverConfig.openaiOrgId && serverConfig.openaiOrgId.trim() !== \"\") {\n      // If openaiOrganizationHeader is present, log it; otherwise, log that the header is not present\n      console.log(\"[Org ID]\", openaiOrganizationHeader);\n    } else {\n      console.log(\"[Org ID] is not set up.\");\n    }\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    // Conditionally delete the OpenAI-Organization header from the response if [Org ID] is undefined or empty (not setup in ENV)\n    // Also, this is to prevent the header from being sent to the client\n    if (!serverConfig.openaiOrgId || serverConfig.openaiOrgId.trim() === \"\") {\n      newHeaders.delete(\"OpenAI-Organization\");\n    }\n\n    // The latest version of the OpenAI API forced the content-encoding to be \"br\" in json response\n    // So if the streaming is disabled, we need to remove the content-encoding header\n    // Because Vercel uses gzip to compress the response, if we don't remove the content-encoding header\n    // The browser will try to decode the response with brotli and fail\n    newHeaders.delete(\"content-encoding\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { type OpenAIListModelResponse } from \"@/app/client/platforms/openai\";\nimport { getServerSideConfig } from \"@/app/config/server\";\nimport { ModelProvider, OpenaiPath } from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"./auth\";\nimport { requestOpenai } from \"./common\";\n\nconst ALLOWED_PATH = new Set(Object.values(OpenaiPath));\n\nfunction getModels(remoteModelRes: OpenAIListModelResponse) {\n  const config = getServerSideConfig();\n\n  if (config.disableGPT4) {\n    remoteModelRes.data = remoteModelRes.data.filter(\n      (m) =>\n        !(m.id.startsWith(\"gpt-4\") || m.id.startsWith(\"chatgpt-4o\") || m.id.startsWith(\"o1\") || m.id.startsWith(\"o3\")) ||\n        m.id.startsWith(\"gpt-4o-mini\"),\n    );\n  }\n\n  return remoteModelRes;\n}\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[OpenAI Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const subpath = params.path.join(\"/\");\n\n  if (!ALLOWED_PATH.has(subpath)) {\n    console.log(\"[OpenAI Route] forbidden path \", subpath);\n    return NextResponse.json(\n      {\n        error: true,\n        msg: \"you are not allowed to request \" + subpath,\n      },\n      {\n        status: 403,\n      },\n    );\n  }\n\n  const authResult = auth(req, ModelProvider.GPT);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await requestOpenai(req);\n\n    // list models\n    if (subpath === OpenaiPath.ListModelPath && response.status === 200) {\n      const resJson = (await response.json()) as OpenAIListModelResponse;\n      const availableModels = getModels(resJson);\n      return NextResponse.json(availableModels, {\n        status: response.status,\n      });\n    }\n\n    return response;\n  } catch (e) {\n    console.error(\"[OpenAI] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n","import { ModelProvider } from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"./auth\";\nimport { requestOpenai } from \"./common\";\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Azure Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const subpath = params.path.join(\"/\");\n\n  const authResult = auth(req, ModelProvider.GPT);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    return await requestOpenai(req);\n  } catch (e) {\n    console.error(\"[Azure] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n","import { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"./auth\";\nimport { getServerSideConfig } from \"@/app/config/server\";\nimport { ApiPath, GEMINI_BASE_URL, ModelProvider } from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { provider: string; path: string[] } },\n) {\n  console.log(\"[Google Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.GeminiPro);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  const bearToken =\n    req.headers.get(\"x-goog-api-key\") || req.headers.get(\"Authorization\") || \"\";\n  const token = bearToken.trim().replaceAll(\"Bearer \", \"\").trim();\n\n  const apiKey = token ? token : serverConfig.googleApiKey;\n\n  if (!apiKey) {\n    return NextResponse.json(\n      {\n        error: true,\n        message: `missing GOOGLE_API_KEY in server env vars`,\n      },\n      {\n        status: 401,\n      },\n    );\n  }\n  try {\n    const response = await request(req, apiKey);\n    return response;\n  } catch (e) {\n    console.error(\"[Google] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nexport const GET = handle;\nexport const POST = handle;\n\nexport const runtime = \"edge\";\nexport const preferredRegion = [\n  \"bom1\",\n  \"cle1\",\n  \"cpt1\",\n  \"gru1\",\n  \"hnd1\",\n  \"iad1\",\n  \"icn1\",\n  \"kix1\",\n  \"pdx1\",\n  \"sfo1\",\n  \"sin1\",\n  \"syd1\",\n];\n\nasync function request(req: NextRequest, apiKey: string) {\n  const controller = new AbortController();\n\n  let baseUrl = serverConfig.googleUrl || GEMINI_BASE_URL;\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Google, \"\");\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n  const fetchUrl = `${baseUrl}${path}${\n    req?.nextUrl?.searchParams?.get(\"alt\") === \"sse\" ? \"?alt=sse\" : \"\"\n  }`;\n\n  console.log(\"[Fetch Url] \", fetchUrl);\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Cache-Control\": \"no-store\",\n      \"x-goog-api-key\":\n        req.headers.get(\"x-goog-api-key\") ||\n        (req.headers.get(\"Authorization\") ?? \"\").replace(\"Bearer \", \"\"),\n    },\n    method: req.method,\n    body: req.body,\n    // to fix #2485: https://stackoverflow.com/questions/55920957/cloudflare-worker-typeerror-one-time-use-body\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  ANTHROPIC_BASE_URL,\n  Anthropic,\n  ApiPath,\n  ServiceProvider,\n  ModelProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"./auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\nimport { cloudflareAIGatewayUrl } from \"@/app/utils/cloudflare\";\n\nconst ALLOWD_PATH = new Set([Anthropic.ChatPath, Anthropic.ChatPath1]);\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Anthropic Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const subpath = params.path.join(\"/\");\n\n  if (!ALLOWD_PATH.has(subpath)) {\n    console.log(\"[Anthropic Route] forbidden path \", subpath);\n    return NextResponse.json(\n      {\n        error: true,\n        msg: \"you are not allowed to request \" + subpath,\n      },\n      {\n        status: 403,\n      },\n    );\n  }\n\n  const authResult = auth(req, ModelProvider.Claude);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Anthropic] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nconst serverConfig = getServerSideConfig();\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  let authHeaderName = \"x-api-key\";\n  let authValue =\n    req.headers.get(authHeaderName) ||\n    req.headers.get(\"Authorization\")?.replaceAll(\"Bearer \", \"\").trim() ||\n    serverConfig.anthropicApiKey ||\n    \"\";\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Anthropic, \"\");\n\n  let baseUrl =\n    serverConfig.anthropicUrl || serverConfig.baseUrl || ANTHROPIC_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  // try rebuild url, when using cloudflare ai gateway in server\n  const fetchUrl = cloudflareAIGatewayUrl(`${baseUrl}${path}`);\n\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Cache-Control\": \"no-store\",\n      \"anthropic-dangerous-direct-browser-access\": \"true\",\n      [authHeaderName]: authValue,\n      \"anthropic-version\":\n        req.headers.get(\"anthropic-version\") ||\n        serverConfig.anthropicApiVersion ||\n        Anthropic.Vision,\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Anthropic as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Anthropic] filter`, e);\n    }\n  }\n  // console.log(\"[Anthropic request]\", fetchOptions.headers, req.method);\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // console.log(\n    //   \"[Anthropic response]\",\n    //   res.status,\n    //   \"   \",\n    //   res.headers,\n    //   res.url,\n    // );\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { BAIDU_OATUH_URL } from \"../constant\";\n/**\n * 使用 AK，SK 生成鉴权签名（Access Token）\n * @return 鉴权签名信息\n */\nexport async function getAccessToken(\n  clientId: string,\n  clientSecret: string,\n): Promise<{\n  access_token: string;\n  expires_in: number;\n  error?: number;\n}> {\n  const res = await fetch(\n    `${BAIDU_OATUH_URL}?grant_type=client_credentials&client_id=${clientId}&client_secret=${clientSecret}`,\n    {\n      method: \"POST\",\n      mode: \"cors\",\n    },\n  );\n  const resJson = await res.json();\n  return resJson;\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  BAIDU_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\nimport { getAccessToken } from \"@/app/utils/baidu\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Baidu Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Ernie);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  if (!serverConfig.baiduApiKey || !serverConfig.baiduSecretKey) {\n    return NextResponse.json(\n      {\n        error: true,\n        message: `missing BAIDU_API_KEY or BAIDU_SECRET_KEY in server env vars`,\n      },\n      {\n        status: 401,\n      },\n    );\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Baidu] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Baidu, \"\");\n\n  let baseUrl = serverConfig.baiduUrl || BAIDU_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const { access_token } = await getAccessToken(\n    serverConfig.baiduApiKey as string,\n    serverConfig.baiduSecretKey as string,\n  );\n  const fetchUrl = `${baseUrl}${path}?access_token=${access_token}`;\n\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Baidu as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Baidu] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  BYTEDANCE_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[ByteDance Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Doubao);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[ByteDance] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.ByteDance, \"\");\n\n  let baseUrl = serverConfig.bytedanceUrl || BYTEDANCE_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.ByteDance as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[ByteDance] filter`, e);\n    }\n  }\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  ALIBABA_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Alibaba Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Qwen);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Alibaba] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Alibaba, \"\");\n\n  let baseUrl = serverConfig.alibabaUrl || ALIBABA_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n      \"X-DashScope-SSE\": req.headers.get(\"X-DashScope-SSE\") ?? \"disable\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Alibaba as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Alibaba] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  MOONSHOT_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Moonshot Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Moonshot);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Moonshot] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Moonshot, \"\");\n\n  let baseUrl = serverConfig.moonshotUrl || MOONSHOT_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Moonshot as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Moonshot] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSideConfig } from \"@/app/config/server\";\nimport { ModelProvider, STABILITY_BASE_URL } from \"@/app/constant\";\nimport { auth } from \"@/app/api/auth\";\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Stability] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const controller = new AbortController();\n\n  const serverConfig = getServerSideConfig();\n\n  let baseUrl = serverConfig.stabilityUrl || STABILITY_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(\"/api/stability/\", \"\");\n\n  console.log(\"[Stability Proxy] \", path);\n  console.log(\"[Stability Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const authResult = auth(req, ModelProvider.Stability);\n\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  const bearToken = req.headers.get(\"Authorization\") ?? \"\";\n  const token = bearToken.trim().replaceAll(\"Bearer \", \"\").trim();\n\n  const key = token ? token : serverConfig.stabilityApiKey;\n\n  if (!key) {\n    return NextResponse.json(\n      {\n        error: true,\n        message: `missing STABILITY_API_KEY in server env vars`,\n      },\n      {\n        status: 401,\n      },\n    );\n  }\n\n  const fetchUrl = `${baseUrl}/${path}`;\n  console.log(\"[Stability Url] \", fetchUrl);\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": req.headers.get(\"Content-Type\") || \"multipart/form-data\",\n      Accept: req.headers.get(\"Accept\") || \"application/json\",\n      Authorization: `Bearer ${key}`,\n    },\n    method: req.method,\n    body: req.body,\n    // to fix #2485: https://stackoverflow.com/questions/55920957/cloudflare-worker-typeerror-one-time-use-body\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  IFLYTEK_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\n// iflytek\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Iflytek Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Iflytek);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Iflytek] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // iflytek use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Iflytek, \"\");\n\n  let baseUrl = serverConfig.iflytekUrl || IFLYTEK_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Iflytek as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Iflytek] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  DEEPSEEK_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[DeepSeek Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.DeepSeek);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[DeepSeek] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.DeepSeek, \"\");\n\n  let baseUrl = serverConfig.deepseekUrl || DEEPSEEK_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.DeepSeek as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[DeepSeek] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  SILICONFLOW_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[SiliconFlow Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.SiliconFlow);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[SiliconFlow] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.SiliconFlow, \"\");\n\n  let baseUrl = serverConfig.siliconFlowUrl || SILICONFLOW_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.SiliconFlow as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[SiliconFlow] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  XAI_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[XAI Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.XAI);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[XAI] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.XAI, \"\");\n\n  let baseUrl = serverConfig.xaiUrl || XAI_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.XAI as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[XAI] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  CHATGLM_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelNotavailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[GLM Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.ChatGLM);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[GLM] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.ChatGLM, \"\");\n\n  let baseUrl = serverConfig.chatglmUrl || CHATGLM_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  console.log(\"[Fetch Url] \", fetchUrl);\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelNotavailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.ChatGLM as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[GLM] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSideConfig } from \"@/app/config/server\";\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Proxy Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n  const serverConfig = getServerSideConfig();\n\n  // remove path params from searchParams\n  req.nextUrl.searchParams.delete(\"path\");\n  req.nextUrl.searchParams.delete(\"provider\");\n\n  const subpath = params.path.join(\"/\");\n  const fetchUrl = `${req.headers.get(\n    \"x-base-url\",\n  )}/${subpath}?${req.nextUrl.searchParams.toString()}`;\n  const skipHeaders = [\"connection\", \"host\", \"origin\", \"referer\", \"cookie\"];\n  const headers = new Headers(\n    Array.from(req.headers.entries()).filter((item) => {\n      if (\n        item[0].indexOf(\"x-\") > -1 ||\n        item[0].indexOf(\"sec-\") > -1 ||\n        skipHeaders.includes(item[0])\n      ) {\n        return false;\n      }\n      return true;\n    }),\n  );\n  // if dalle3 use openai api key\n    const baseUrl = req.headers.get(\"x-base-url\");\n    if (baseUrl?.includes(\"api.openai.com\")) {\n      if (!serverConfig.apiKey) {\n        return NextResponse.json(\n          { error: \"OpenAI API key not configured\" },\n          { status: 500 },\n        );\n      }\n      headers.set(\"Authorization\", `Bearer ${serverConfig.apiKey}`);\n    }\n\n  const controller = new AbortController();\n  const fetchOptions: RequestInit = {\n    headers,\n    method: req.method,\n    body: req.body,\n    // to fix #2485: https://stackoverflow.com/questions/55920957/cloudflare-worker-typeerror-one-time-use-body\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    // The latest version of the OpenAI API forced the content-encoding to be \"br\" in json response\n    // So if the streaming is disabled, we need to remove the content-encoding header\n    // Because Vercel uses gzip to compress the response, if we don't remove the content-encoding header\n    // The browser will try to decode the response with brotli and fail\n    newHeaders.delete(\"content-encoding\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { ApiPath } from \"@/app/constant\";\nimport { NextRequest } from \"next/server\";\nimport { handle as openaiHandler } from \"../../openai\";\nimport { handle as azureHandler } from \"../../azure\";\nimport { handle as googleHandler } from \"../../google\";\nimport { handle as anthropicHandler } from \"../../anthropic\";\nimport { handle as baiduHandler } from \"../../baidu\";\nimport { handle as bytedanceHandler } from \"../../bytedance\";\nimport { handle as alibabaHandler } from \"../../alibaba\";\nimport { handle as moonshotHandler } from \"../../moonshot\";\nimport { handle as stabilityHandler } from \"../../stability\";\nimport { handle as iflytekHandler } from \"../../iflytek\";\nimport { handle as deepseekHandler } from \"../../deepseek\";\nimport { handle as siliconflowHandler } from \"../../siliconflow\";\nimport { handle as xaiHandler } from \"../../xai\";\nimport { handle as chatglmHandler } from \"../../glm\";\nimport { handle as proxyHandler } from \"../../proxy\";\n\nasync function handle(\n  req: NextRequest,\n  { params }: { params: { provider: string; path: string[] } },\n) {\n  const apiPath = `/api/${params.provider}`;\n  console.log(`[${params.provider} Route] params `, params);\n  switch (apiPath) {\n    case ApiPath.Azure:\n      return azureHandler(req, { params });\n    case ApiPath.Google:\n      return googleHandler(req, { params });\n    case ApiPath.Anthropic:\n      return anthropicHandler(req, { params });\n    case ApiPath.Baidu:\n      return baiduHandler(req, { params });\n    case ApiPath.ByteDance:\n      return bytedanceHandler(req, { params });\n    case ApiPath.Alibaba:\n      return alibabaHandler(req, { params });\n    // case ApiPath.Tencent: using \"/api/tencent\"\n    case ApiPath.Moonshot:\n      return moonshotHandler(req, { params });\n    case ApiPath.Stability:\n      return stabilityHandler(req, { params });\n    case ApiPath.Iflytek:\n      return iflytekHandler(req, { params });\n    case ApiPath.DeepSeek:\n      return deepseekHandler(req, { params });\n    case ApiPath.XAI:\n      return xaiHandler(req, { params });\n    case ApiPath.ChatGLM:\n      return chatglmHandler(req, { params });\n    case ApiPath.SiliconFlow:\n      return siliconflowHandler(req, { params });\n    case ApiPath.OpenAI:\n      return openaiHandler(req, { params });\n    default:\n      return proxyHandler(req, { params });\n  }\n}\n\nexport const GET = handle;\nexport const POST = handle;\n\nexport const runtime = \"edge\";\nexport const preferredRegion = [\n  \"arn1\",\n  \"bom1\",\n  \"cdg1\",\n  \"cle1\",\n  \"cpt1\",\n  \"dub1\",\n  \"fra1\",\n  \"gru1\",\n  \"hnd1\",\n  \"iad1\",\n  \"icn1\",\n  \"kix1\",\n  \"lhr1\",\n  \"pdx1\",\n  \"sfo1\",\n  \"sin1\",\n  \"syd1\",\n];\n","import { AppRouteRouteModule } from \"next/dist/server/future/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/future/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"/Volumes/D/github/ChatGPT-Next-Web/app/api/[provider]/[...path]/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/[provider]/[...path]/route\",\n        pathname: \"/api/[provider]/[...path]\",\n        filename: \"route\",\n        bundlePath: \"app/api/[provider]/[...path]/route\"\n    },\n    resolvedPagePath: \"/Volumes/D/github/ChatGPT-Next-Web/app/api/[provider]/[...path]/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/[provider]/[...path]/route\";\nfunction patchFetch() {\n    return _patchFetch({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\nexport { routeModule, requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout, originalPathname, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","import { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2F%5Bprovider%5D%2F%5B...path%5D%2Froute&page=%2Fapi%2F%5Bprovider%5D%2F%5B...path%5D%2Froute&pagePath=private-next-app-dir%2Fapi%2F%5Bprovider%5D%2F%5B...path%5D%2Froute.ts&appDir=%2FVolumes%2FD%2Fgithub%2FChatGPT-Next-Web%2Fapp&appPaths=%2Fapi%2F%5Bprovider%5D%2F%5B...path%5D%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=arn1&preferredRegion=bom1&preferredRegion=cdg1&preferredRegion=cle1&preferredRegion=cpt1&preferredRegion=dub1&preferredRegion=fra1&preferredRegion=gru1&preferredRegion=hnd1&preferredRegion=iad1&preferredRegion=icn1&preferredRegion=kix1&preferredRegion=lhr1&preferredRegion=pdx1&preferredRegion=sfo1&preferredRegion=sin1&preferredRegion=syd1&middlewareConfig=e30%3D!private-next-app-dir/api/[provider]/[...path]/route.ts?__next_edge_ssr_entry__\";\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule);\n\n//# sourceMappingURL=edge-app-route.js.map","import { NextRequest } from \"next/server\";\nimport { getServerSideConfig } from \"../config/server\";\nimport md5 from \"spark-md5\";\nimport { ACCESS_CODE_PREFIX, ModelProvider } from \"../constant\";\n\nfunction getIP(req: NextRequest) {\n  let ip = req.ip ?? req.headers.get(\"x-real-ip\");\n  const forwardedFor = req.headers.get(\"x-forwarded-for\");\n\n  if (!ip && forwardedFor) {\n    ip = forwardedFor.split(\",\").at(0) ?? \"\";\n  }\n\n  return ip;\n}\n\nfunction parseApiKey(bearToken: string) {\n  const token = bearToken.trim().replaceAll(\"Bearer \", \"\").trim();\n  const isApiKey = !token.startsWith(ACCESS_CODE_PREFIX);\n\n  return {\n    accessCode: isApiKey ? \"\" : token.slice(ACCESS_CODE_PREFIX.length),\n    apiKey: isApiKey ? token : \"\",\n  };\n}\n\nexport function auth(req: NextRequest, modelProvider: ModelProvider) {\n  const authToken = req.headers.get(\"Authorization\") ?? \"\";\n\n  // check if it is openai api key or user token\n  const { accessCode, apiKey } = parseApiKey(authToken);\n\n  const hashedCode = md5.hash(accessCode ?? \"\").trim();\n\n  const serverConfig = getServerSideConfig();\n  console.log(\"[Auth] allowed hashed codes: \", [...serverConfig.codes]);\n  console.log(\"[Auth] got access code:\", accessCode);\n  console.log(\"[Auth] hashed access code:\", hashedCode);\n  console.log(\"[User IP] \", getIP(req));\n  console.log(\"[Time] \", new Date().toLocaleString());\n\n  if (serverConfig.needCode && !serverConfig.codes.has(hashedCode) && !apiKey) {\n    return {\n      error: true,\n      msg: !accessCode ? \"empty access code\" : \"wrong access code\",\n    };\n  }\n\n  if (serverConfig.hideUserApiKey && !!apiKey) {\n    return {\n      error: true,\n      msg: \"you are not allowed to access with your own api key\",\n    };\n  }\n\n  // if user does not provide an api key, inject system api key\n  if (!apiKey) {\n    const serverConfig = getServerSideConfig();\n\n    // const systemApiKey =\n    //   modelProvider === ModelProvider.GeminiPro\n    //     ? serverConfig.googleApiKey\n    //     : serverConfig.isAzure\n    //     ? serverConfig.azureApiKey\n    //     : serverConfig.apiKey;\n\n    let systemApiKey: string | undefined;\n\n    switch (modelProvider) {\n      case ModelProvider.Stability:\n        systemApiKey = serverConfig.stabilityApiKey;\n        break;\n      case ModelProvider.GeminiPro:\n        systemApiKey = serverConfig.googleApiKey;\n        break;\n      case ModelProvider.Claude:\n        systemApiKey = serverConfig.anthropicApiKey;\n        break;\n      case ModelProvider.Doubao:\n        systemApiKey = serverConfig.bytedanceApiKey;\n        break;\n      case ModelProvider.Ernie:\n        systemApiKey = serverConfig.baiduApiKey;\n        break;\n      case ModelProvider.Qwen:\n        systemApiKey = serverConfig.alibabaApiKey;\n        break;\n      case ModelProvider.Moonshot:\n        systemApiKey = serverConfig.moonshotApiKey;\n        break;\n      case ModelProvider.Iflytek:\n        systemApiKey =\n          serverConfig.iflytekApiKey + \":\" + serverConfig.iflytekApiSecret;\n        break;\n      case ModelProvider.DeepSeek:\n        systemApiKey = serverConfig.deepseekApiKey;\n        break;\n      case ModelProvider.XAI:\n        systemApiKey = serverConfig.xaiApiKey;\n        break;\n      case ModelProvider.ChatGLM:\n        systemApiKey = serverConfig.chatglmApiKey;\n        break;\n      case ModelProvider.SiliconFlow:\n        systemApiKey = serverConfig.siliconFlowApiKey;\n        break;\n      case ModelProvider.GPT:\n      default:\n        if (req.nextUrl.pathname.includes(\"azure/deployments\")) {\n          systemApiKey = serverConfig.azureApiKey;\n        } else {\n          systemApiKey = serverConfig.apiKey;\n        }\n    }\n\n    if (systemApiKey) {\n      console.log(\"[Auth] use system api key\");\n      req.headers.set(\"Authorization\", `Bearer ${systemApiKey}`);\n    } else {\n      console.log(\"[Auth] admin did not provide an api key\");\n    }\n  } else {\n    console.log(\"[Auth] use user api key\");\n  }\n\n  return {\n    error: false,\n  };\n}\n","export function prettyObject(msg: any) {\n  const obj = msg;\n  if (typeof msg !== \"string\") {\n    msg = JSON.stringify(msg, null, \"  \");\n  }\n  if (msg === \"{}\") {\n    return obj.toString();\n  }\n  if (msg.startsWith(\"```json\")) {\n    return msg;\n  }\n  return [\"```json\", msg, \"```\"].join(\"\\n\");\n}\n\nexport function* chunks(s: string, maxBytes = 1000 * 1000) {\n  const decoder = new TextDecoder(\"utf-8\");\n  let buf = new TextEncoder().encode(s);\n  while (buf.length) {\n    let i = buf.lastIndexOf(32, maxBytes + 1);\n    // If no space found, try forward search\n    if (i < 0) i = buf.indexOf(32, maxBytes);\n    // If there's no space at all, take all\n    if (i < 0) i = buf.length;\n    // This is a safe cut-off point; never half-way a multi-byte\n    yield decoder.decode(buf.slice(0, i));\n    buf = buf.slice(i + 1); // Skip space (if any)\n  }\n}\n"],"names":["module","exports","require","cloudflareAIGatewayUrl","fetchUrl","paths","split","slice","concat","join","serverConfig","getServerSideConfig","requestOpenai","req","controller","AbortController","isAzure","nextUrl","pathname","includes","authValue","authHeaderName","headers","get","trim","replaceAll","path","baseUrl","azureUrl","OPENAI_BASE_URL","startsWith","endsWith","console","log","timeoutId","setTimeout","abort","azureApiVersion","searchParams","shift","customModels","modelName","realDeployName","filter","v","forEach","fullName","displayName","m","_","providerName","getModelProvider","deployId","fetchOptions","openaiOrgId","method","body","redirect","duplex","signal","clonedBody","text","jsonBody","JSON","parse","isModelNotavailableInServer","model","ServiceProvider","OpenAI","Azure","NextResponse","json","error","message","status","e","res","fetch","openaiOrganizationHeader","newHeaders","Headers","delete","set","Response","statusText","clearTimeout","ALLOWED_PATH","Set","Object","values","OpenaiPath","handle","params","subpath","has","msg","authResult","auth","ModelProvider","GPT","response","ListModelPath","remoteModelRes","availableModels","config","disableGPT4","data","id","prettyObject","GeminiPro","apiKey","token","googleApiKey","request","googleUrl","GEMINI_BASE_URL","ApiPath","Google","replace","ALLOWD_PATH","Anthropic","ChatPath","ChatPath1","Claude","anthropicApiKey","anthropicUrl","ANTHROPIC_BASE_URL","anthropicApiVersion","Vision","getAccessToken","clientId","clientSecret","BAIDU_OATUH_URL","mode","Ernie","baiduApiKey","baiduSecretKey","Baidu","baiduUrl","BAIDU_BASE_URL","access_token","Doubao","ByteDance","bytedanceUrl","BYTEDANCE_BASE_URL","Authorization","Qwen","Alibaba","alibabaUrl","ALIBABA_BASE_URL","Moonshot","moonshotUrl","MOONSHOT_BASE_URL","stabilityUrl","STABILITY_BASE_URL","Stability","key","stabilityApiKey","Accept","Iflytek","iflytekUrl","IFLYTEK_BASE_URL","DeepSeek","deepseekUrl","DEEPSEEK_BASE_URL","SiliconFlow","siliconFlowUrl","SILICONFLOW_BASE_URL","XAI","xaiUrl","XAI_BASE_URL","ChatGLM","chatglmUrl","CHATGLM_BASE_URL","toString","skipHeaders","Array","from","entries","item","indexOf","apiPath","provider","azureHandler","googleHandler","anthropicHandler","baiduHandler","bytedanceHandler","alibabaHandler","moonshotHandler","stabilityHandler","iflytekHandler","deepseekHandler","xaiHandler","chatglmHandler","siliconflowHandler","openaiHandler","proxyHandler","GET","POST","runtime","preferredRegion","routeModule","module_compiled","AppRouteRouteModule","definition","kind","route_kind","x","APP_ROUTE","page","filename","bundlePath","resolvedPagePath","nextConfigOutput","userland","route_namespaceObject","requestAsyncStorage","staticGenerationAsyncStorage","serverHooks","headerHooks","staticGenerationBailout","originalPathname","patchFetch","patch_fetch","XH","ComponentMod","route_next_edge_ssr_entry_namespaceObject","next_edge_app_route_loaderabsolutePagePath_private_next_app_dir_2Fapi_2F_5Bprovider_5D_2F_5B_path_5D_2Froute_ts_page_2Fapi_2F_5Bprovider_5D_2F_5B_path_5D_2Froute_appDirLoader_bmV4dC1hcHAtbG9hZGVyP25hbWU9YXBwJTJGYXBpJTJGJTVCcHJvdmlkZXIlNUQlMkYlNUIuLi5wYXRoJTVEJTJGcm91dGUmcGFnZT0lMkZhcGklMkYlNUJwcm92aWRlciU1RCUyRiU1Qi4uLnBhdGglNUQlMkZyb3V0ZSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRiU1QnByb3ZpZGVyJTVEJTJGJTVCLi4ucGF0aCU1RCUyRnJvdXRlLnRzJmFwcERpcj0lMkZWb2x1bWVzJTJGRCUyRmdpdGh1YiUyRkNoYXRHUFQtTmV4dC1XZWIlMkZhcHAmYXBwUGF0aHM9JTJGYXBpJTJGJTVCcHJvdmlkZXIlNUQlMkYlNUIuLi5wYXRoJTVEJTJGcm91dGUmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249YXJuMSZwcmVmZXJyZWRSZWdpb249Ym9tMSZwcmVmZXJyZWRSZWdpb249Y2RnMSZwcmVmZXJyZWRSZWdpb249Y2xlMSZwcmVmZXJyZWRSZWdpb249Y3B0MSZwcmVmZXJyZWRSZWdpb249ZHViMSZwcmVmZXJyZWRSZWdpb249ZnJhMSZwcmVmZXJyZWRSZWdpb249Z3J1MSZwcmVmZXJyZWRSZWdpb249aG5kMSZwcmVmZXJyZWRSZWdpb249aWFkMSZwcmVmZXJyZWRSZWdpb249aWNuMSZwcmVmZXJyZWRSZWdpb249a2l4MSZwcmVmZXJyZWRSZWdpb249bGhyMSZwcmVmZXJyZWRSZWdpb249cGR4MSZwcmVmZXJyZWRSZWdpb249c2ZvMSZwcmVmZXJyZWRSZWdpb249c2luMSZwcmVmZXJyZWRSZWdpb249c3lkMSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCE_3D_nextConfigOutput_standalone_preferredRegion_arn1_preferredRegion_bom1_preferredRegion_cdg1_preferredRegion_cle1_preferredRegion_cpt1_preferredRegion_dub1_preferredRegion_fra1_preferredRegion_gru1_preferredRegion_hnd1_preferredRegion_iad1_preferredRegion_icn1_preferredRegion_kix1_preferredRegion_lhr1_preferredRegion_pdx1_preferredRegion_sfo1_preferredRegion_sin1_preferredRegion_syd1_middlewareConfig_e30_3D_","edge_route_module_wrapper","a","wrap","modelProvider","accessCode","parseApiKey","bearToken","isApiKey","ACCESS_CODE_PREFIX","length","hashedCode","md5","codes","getIP","ip","forwardedFor","at","Date","toLocaleString","needCode","hideUserApiKey","systemApiKey","bytedanceApiKey","alibabaApiKey","moonshotApiKey","iflytekApiKey","iflytekApiSecret","deepseekApiKey","xaiApiKey","chatglmApiKey","siliconFlowApiKey","azureApiKey","obj","stringify"],"sourceRoot":""}