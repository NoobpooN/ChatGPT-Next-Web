{"version":3,"file":"app/api/[provider]/[...path]/route.js","mappings":"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","sources":["webpack://_N_E/external commonjs \"node:async_hooks\"","webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/./app/utils/cloudflare.ts","webpack://_N_E/./app/utils/model.ts","webpack://_N_E/./app/api/common.ts","webpack://_N_E/./app/api/openai.ts","webpack://_N_E/./app/api/azure.ts","webpack://_N_E/./app/api/google.ts","webpack://_N_E/./app/api/anthropic.ts","webpack://_N_E/./app/utils/baidu.ts","webpack://_N_E/./app/api/baidu.ts","webpack://_N_E/./app/api/bytedance.ts","webpack://_N_E/./app/api/alibaba.ts","webpack://_N_E/./app/api/moonshot.ts","webpack://_N_E/./app/api/stability.ts","webpack://_N_E/./app/api/iflytek.ts","webpack://_N_E/./app/api/xai.ts","webpack://_N_E/./app/api/glm.ts","webpack://_N_E/./app/api/proxy.ts","webpack://_N_E/./app/api/[provider]/[...path]/route.ts","webpack://_N_E/./app/api/[provider]/[...path]/route.ts?da5f","webpack://_N_E/?ee54","webpack://_N_E/./app/api/auth.ts","webpack://_N_E/./app/utils/format.ts","webpack://_N_E/<anon>"],"sourcesContent":["module.exports = require(\"node:async_hooks\");","module.exports = require(\"node:buffer\");","export function cloudflareAIGatewayUrl(fetchUrl: string) {\n  // rebuild fetchUrl, if using cloudflare ai gateway\n  // document: https://developers.cloudflare.com/ai-gateway/providers/openai/\n\n  const paths = fetchUrl.split(\"/\");\n  if (\"gateway.ai.cloudflare.com\" == paths[2]) {\n    // is cloudflare.com ai gateway\n    // https://gateway.ai.cloudflare.com/v1/{account_id}/{gateway_id}/azure-openai/{resource_name}/{deployment_name}/chat/completions?api-version=2023-05-15'\n    if (\"azure-openai\" == paths[6]) {\n      // is azure gateway\n      return paths.slice(0, 8).concat(paths.slice(-3)).join(\"/\"); // rebuild ai gateway azure_url\n    }\n    // https://gateway.ai.cloudflare.com/v1/{account_id}/{gateway_id}/openai/chat/completions\n    if (\"openai\" == paths[6]) {\n      // is openai gateway\n      return paths.slice(0, 7).concat(paths.slice(-2)).join(\"/\"); // rebuild ai gateway openai_url\n    }\n    // https://gateway.ai.cloudflare.com/v1/{account_id}/{gateway_id}/anthropic/v1/messages \\\n    if (\"anthropic\" == paths[6]) {\n      // is anthropic gateway\n      return paths.slice(0, 7).concat(paths.slice(-2)).join(\"/\"); // rebuild ai gateway anthropic_url\n    }\n    // TODO: Amazon Bedrock, Groq, HuggingFace...\n  }\n  return fetchUrl;\n}\n","import { DEFAULT_MODELS } from \"../constant\";\nimport { LLMModel } from \"../client/api\";\n\nconst CustomSeq = {\n  val: -1000, //To ensure the custom model located at front, start from -1000, refer to constant.ts\n  cache: new Map<string, number>(),\n  next: (id: string) => {\n    if (CustomSeq.cache.has(id)) {\n      return CustomSeq.cache.get(id) as number;\n    } else {\n      let seq = CustomSeq.val++;\n      CustomSeq.cache.set(id, seq);\n      return seq;\n    }\n  },\n};\n\nconst customProvider = (providerName: string) => ({\n  id: providerName.toLowerCase(),\n  providerName: providerName,\n  providerType: \"custom\",\n  sorted: CustomSeq.next(providerName),\n});\n\n/**\n * Sorts an array of models based on specified rules.\n *\n * First, sorted by provider; if the same, sorted by model\n */\nconst sortModelTable = (models: ReturnType<typeof collectModels>) =>\n  models.sort((a, b) => {\n    if (a.provider && b.provider) {\n      let cmp = a.provider.sorted - b.provider.sorted;\n      return cmp === 0 ? a.sorted - b.sorted : cmp;\n    } else {\n      return a.sorted - b.sorted;\n    }\n  });\n\n/**\n * get model name and provider from a formatted string,\n * e.g. `gpt-4@OpenAi` or `claude-3-5-sonnet@20240620@Google`\n * @param modelWithProvider model name with provider separated by last `@` char,\n * @returns [model, provider] tuple, if no `@` char found, provider is undefined\n */\nexport function getModelProvider(modelWithProvider: string): [string, string?] {\n  const [model, provider] = modelWithProvider.split(/@(?!.*@)/);\n  return [model, provider];\n}\n\nexport function collectModelTable(\n  models: readonly LLMModel[],\n  customModels: string,\n) {\n  const modelTable: Record<\n    string,\n    {\n      available: boolean;\n      name: string;\n      displayName: string;\n      sorted: number;\n      provider?: LLMModel[\"provider\"]; // Marked as optional\n      isDefault?: boolean;\n    }\n  > = {};\n\n  // default models\n  models.forEach((m) => {\n    // using <modelName>@<providerId> as fullName\n    modelTable[`${m.name}@${m?.provider?.id}`] = {\n      ...m,\n      displayName: m.name, // 'provider' is copied over if it exists\n    };\n  });\n\n  // server custom models\n  customModels\n    .split(\",\")\n    .filter((v) => !!v && v.length > 0)\n    .forEach((m) => {\n      const available = !m.startsWith(\"-\");\n      const nameConfig =\n        m.startsWith(\"+\") || m.startsWith(\"-\") ? m.slice(1) : m;\n      let [name, displayName] = nameConfig.split(\"=\");\n\n      // enable or disable all models\n      if (name === \"all\") {\n        Object.values(modelTable).forEach(\n          (model) => (model.available = available),\n        );\n      } else {\n        // 1. find model by name, and set available value\n        const [customModelName, customProviderName] = getModelProvider(name);\n        let count = 0;\n        for (const fullName in modelTable) {\n          const [modelName, providerName] = getModelProvider(fullName);\n          if (\n            customModelName == modelName &&\n            (customProviderName === undefined ||\n              customProviderName === providerName)\n          ) {\n            count += 1;\n            modelTable[fullName][\"available\"] = available;\n            // swap name and displayName for bytedance\n            if (providerName === \"bytedance\") {\n              [name, displayName] = [displayName, modelName];\n              modelTable[fullName][\"name\"] = name;\n            }\n            if (displayName) {\n              modelTable[fullName][\"displayName\"] = displayName;\n            }\n          }\n        }\n        // 2. if model not exists, create new model with available value\n        if (count === 0) {\n          let [customModelName, customProviderName] = getModelProvider(name);\n          const provider = customProvider(\n            customProviderName || customModelName,\n          );\n          // swap name and displayName for bytedance\n          if (displayName && provider.providerName == \"ByteDance\") {\n            [customModelName, displayName] = [displayName, customModelName];\n          }\n          modelTable[`${customModelName}@${provider?.id}`] = {\n            name: customModelName,\n            displayName: displayName || customModelName,\n            available,\n            provider, // Use optional chaining\n            sorted: CustomSeq.next(`${customModelName}@${provider?.id}`),\n          };\n        }\n      }\n    });\n\n  return modelTable;\n}\n\nexport function collectModelTableWithDefaultModel(\n  models: readonly LLMModel[],\n  customModels: string,\n  defaultModel: string,\n) {\n  let modelTable = collectModelTable(models, customModels);\n  if (defaultModel && defaultModel !== \"\") {\n    if (defaultModel.includes(\"@\")) {\n      if (defaultModel in modelTable) {\n        modelTable[defaultModel].isDefault = true;\n      }\n    } else {\n      for (const key of Object.keys(modelTable)) {\n        if (\n          modelTable[key].available &&\n          getModelProvider(key)[0] == defaultModel\n        ) {\n          modelTable[key].isDefault = true;\n          break;\n        }\n      }\n    }\n  }\n  return modelTable;\n}\n\n/**\n * Generate full model table.\n */\nexport function collectModels(\n  models: readonly LLMModel[],\n  customModels: string,\n) {\n  const modelTable = collectModelTable(models, customModels);\n  let allModels = Object.values(modelTable);\n\n  allModels = sortModelTable(allModels);\n\n  return allModels;\n}\n\nexport function collectModelsWithDefaultModel(\n  models: readonly LLMModel[],\n  customModels: string,\n  defaultModel: string,\n) {\n  const modelTable = collectModelTableWithDefaultModel(\n    models,\n    customModels,\n    defaultModel,\n  );\n  let allModels = Object.values(modelTable);\n\n  allModels = sortModelTable(allModels);\n\n  return allModels;\n}\n\nexport function isModelAvailableInServer(\n  customModels: string,\n  modelName: string,\n  providerName: string,\n) {\n  const fullName = `${modelName}@${providerName}`;\n  const modelTable = collectModelTable(DEFAULT_MODELS, customModels);\n  return modelTable[fullName]?.available === false;\n}\n","import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSideConfig } from \"../config/server\";\nimport { OPENAI_BASE_URL, ServiceProvider } from \"../constant\";\nimport { cloudflareAIGatewayUrl } from \"../utils/cloudflare\";\nimport { getModelProvider, isModelAvailableInServer } from \"../utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function requestOpenai(req: NextRequest) {\n  const controller = new AbortController();\n\n  const isAzure = req.nextUrl.pathname.includes(\"azure/deployments\");\n\n  var authValue,\n    authHeaderName = \"\";\n  if (isAzure) {\n    authValue =\n      req.headers\n        .get(\"Authorization\")\n        ?.trim()\n        .replaceAll(\"Bearer \", \"\")\n        .trim() ?? \"\";\n\n    authHeaderName = \"api-key\";\n  } else {\n    authValue = req.headers.get(\"Authorization\") ?? \"\";\n    authHeaderName = \"Authorization\";\n  }\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(\"/api/openai/\", \"\");\n\n  let baseUrl =\n    (isAzure ? serverConfig.azureUrl : serverConfig.baseUrl) || OPENAI_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  if (isAzure) {\n    const azureApiVersion =\n      req?.nextUrl?.searchParams?.get(\"api-version\") ||\n      serverConfig.azureApiVersion;\n    baseUrl = baseUrl.split(\"/deployments\").shift() as string;\n    path = `${req.nextUrl.pathname.replaceAll(\n      \"/api/azure/\",\n      \"\",\n    )}?api-version=${azureApiVersion}`;\n\n    // Forward compatibility:\n    // if display_name(deployment_name) not set, and '{deploy-id}' in AZURE_URL\n    // then using default '{deploy-id}'\n    if (serverConfig.customModels && serverConfig.azureUrl) {\n      const modelName = path.split(\"/\")[1];\n      let realDeployName = \"\";\n      serverConfig.customModels\n        .split(\",\")\n        .filter((v) => !!v && !v.startsWith(\"-\") && v.includes(modelName))\n        .forEach((m) => {\n          const [fullName, displayName] = m.split(\"=\");\n          const [_, providerName] = getModelProvider(fullName);\n          if (providerName === \"azure\" && !displayName) {\n            const [_, deployId] = (serverConfig?.azureUrl ?? \"\").split(\n              \"deployments/\",\n            );\n            if (deployId) {\n              realDeployName = deployId;\n            }\n          }\n        });\n      if (realDeployName) {\n        console.log(\"[Replace with DeployId\", realDeployName);\n        path = path.replaceAll(modelName, realDeployName);\n      }\n    }\n  }\n\n  const fetchUrl = cloudflareAIGatewayUrl(`${baseUrl}/${path}`);\n  console.log(\"fetchUrl\", fetchUrl);\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Cache-Control\": \"no-store\",\n      [authHeaderName]: authValue,\n      ...(serverConfig.openaiOrgId && {\n        \"OpenAI-Organization\": serverConfig.openaiOrgId,\n      }),\n    },\n    method: req.method,\n    body: req.body,\n    // to fix #2485: https://stackoverflow.com/questions/55920957/cloudflare-worker-typeerror-one-time-use-body\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse gpt4 request\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.OpenAI as string,\n        ) ||\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Azure as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(\"[OpenAI] gpt4 filter\", e);\n    }\n  }\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // Extract the OpenAI-Organization header from the response\n    const openaiOrganizationHeader = res.headers.get(\"OpenAI-Organization\");\n\n    // Check if serverConfig.openaiOrgId is defined and not an empty string\n    if (serverConfig.openaiOrgId && serverConfig.openaiOrgId.trim() !== \"\") {\n      // If openaiOrganizationHeader is present, log it; otherwise, log that the header is not present\n      console.log(\"[Org ID]\", openaiOrganizationHeader);\n    } else {\n      console.log(\"[Org ID] is not set up.\");\n    }\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    // Conditionally delete the OpenAI-Organization header from the response if [Org ID] is undefined or empty (not setup in ENV)\n    // Also, this is to prevent the header from being sent to the client\n    if (!serverConfig.openaiOrgId || serverConfig.openaiOrgId.trim() === \"\") {\n      newHeaders.delete(\"OpenAI-Organization\");\n    }\n\n    // The latest version of the OpenAI API forced the content-encoding to be \"br\" in json response\n    // So if the streaming is disabled, we need to remove the content-encoding header\n    // Because Vercel uses gzip to compress the response, if we don't remove the content-encoding header\n    // The browser will try to decode the response with brotli and fail\n    newHeaders.delete(\"content-encoding\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { type OpenAIListModelResponse } from \"@/app/client/platforms/openai\";\nimport { getServerSideConfig } from \"@/app/config/server\";\nimport { ModelProvider, OpenaiPath } from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"./auth\";\nimport { requestOpenai } from \"./common\";\n\nconst ALLOWED_PATH = new Set(Object.values(OpenaiPath));\n\nfunction getModels(remoteModelRes: OpenAIListModelResponse) {\n  const config = getServerSideConfig();\n\n  if (config.disableGPT4) {\n    remoteModelRes.data = remoteModelRes.data.filter(\n      (m) =>\n        !(m.id.startsWith(\"gpt-4\") || m.id.startsWith(\"chatgpt-4o\") || m.id.startsWith(\"o1\")) ||\n        m.id.startsWith(\"gpt-4o-mini\"),\n    );\n  }\n\n  return remoteModelRes;\n}\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[OpenAI Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const subpath = params.path.join(\"/\");\n\n  if (!ALLOWED_PATH.has(subpath)) {\n    console.log(\"[OpenAI Route] forbidden path \", subpath);\n    return NextResponse.json(\n      {\n        error: true,\n        msg: \"you are not allowed to request \" + subpath,\n      },\n      {\n        status: 403,\n      },\n    );\n  }\n\n  const authResult = auth(req, ModelProvider.GPT);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await requestOpenai(req);\n\n    // list models\n    if (subpath === OpenaiPath.ListModelPath && response.status === 200) {\n      const resJson = (await response.json()) as OpenAIListModelResponse;\n      const availableModels = getModels(resJson);\n      return NextResponse.json(availableModels, {\n        status: response.status,\n      });\n    }\n\n    return response;\n  } catch (e) {\n    console.error(\"[OpenAI] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n","import { ModelProvider } from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"./auth\";\nimport { requestOpenai } from \"./common\";\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Azure Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const subpath = params.path.join(\"/\");\n\n  const authResult = auth(req, ModelProvider.GPT);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    return await requestOpenai(req);\n  } catch (e) {\n    console.error(\"[Azure] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n","import { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"./auth\";\nimport { getServerSideConfig } from \"@/app/config/server\";\nimport { ApiPath, GEMINI_BASE_URL, ModelProvider } from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { provider: string; path: string[] } },\n) {\n  console.log(\"[Google Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.GeminiPro);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  const bearToken =\n    req.headers.get(\"x-goog-api-key\") || req.headers.get(\"Authorization\") || \"\";\n  const token = bearToken.trim().replaceAll(\"Bearer \", \"\").trim();\n\n  const apiKey = token ? token : serverConfig.googleApiKey;\n\n  if (!apiKey) {\n    return NextResponse.json(\n      {\n        error: true,\n        message: `missing GOOGLE_API_KEY in server env vars`,\n      },\n      {\n        status: 401,\n      },\n    );\n  }\n  try {\n    const response = await request(req, apiKey);\n    return response;\n  } catch (e) {\n    console.error(\"[Google] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nexport const GET = handle;\nexport const POST = handle;\n\nexport const runtime = \"edge\";\nexport const preferredRegion = [\n  \"bom1\",\n  \"cle1\",\n  \"cpt1\",\n  \"gru1\",\n  \"hnd1\",\n  \"iad1\",\n  \"icn1\",\n  \"kix1\",\n  \"pdx1\",\n  \"sfo1\",\n  \"sin1\",\n  \"syd1\",\n];\n\nasync function request(req: NextRequest, apiKey: string) {\n  const controller = new AbortController();\n\n  let baseUrl = serverConfig.googleUrl || GEMINI_BASE_URL;\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Google, \"\");\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n  const fetchUrl = `${baseUrl}${path}${\n    req?.nextUrl?.searchParams?.get(\"alt\") === \"sse\" ? \"?alt=sse\" : \"\"\n  }`;\n\n  console.log(\"[Fetch Url] \", fetchUrl);\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Cache-Control\": \"no-store\",\n      \"x-goog-api-key\":\n        req.headers.get(\"x-goog-api-key\") ||\n        (req.headers.get(\"Authorization\") ?? \"\").replace(\"Bearer \", \"\"),\n    },\n    method: req.method,\n    body: req.body,\n    // to fix #2485: https://stackoverflow.com/questions/55920957/cloudflare-worker-typeerror-one-time-use-body\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  ANTHROPIC_BASE_URL,\n  Anthropic,\n  ApiPath,\n  ServiceProvider,\n  ModelProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"./auth\";\nimport { isModelAvailableInServer } from \"@/app/utils/model\";\nimport { cloudflareAIGatewayUrl } from \"@/app/utils/cloudflare\";\n\nconst ALLOWD_PATH = new Set([Anthropic.ChatPath, Anthropic.ChatPath1]);\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Anthropic Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const subpath = params.path.join(\"/\");\n\n  if (!ALLOWD_PATH.has(subpath)) {\n    console.log(\"[Anthropic Route] forbidden path \", subpath);\n    return NextResponse.json(\n      {\n        error: true,\n        msg: \"you are not allowed to request \" + subpath,\n      },\n      {\n        status: 403,\n      },\n    );\n  }\n\n  const authResult = auth(req, ModelProvider.Claude);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Anthropic] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nconst serverConfig = getServerSideConfig();\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  let authHeaderName = \"x-api-key\";\n  let authValue =\n    req.headers.get(authHeaderName) ||\n    req.headers.get(\"Authorization\")?.replaceAll(\"Bearer \", \"\").trim() ||\n    serverConfig.anthropicApiKey ||\n    \"\";\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Anthropic, \"\");\n\n  let baseUrl =\n    serverConfig.anthropicUrl || serverConfig.baseUrl || ANTHROPIC_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  // try rebuild url, when using cloudflare ai gateway in server\n  const fetchUrl = cloudflareAIGatewayUrl(`${baseUrl}${path}`);\n\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Cache-Control\": \"no-store\",\n      \"anthropic-dangerous-direct-browser-access\": \"true\",\n      [authHeaderName]: authValue,\n      \"anthropic-version\":\n        req.headers.get(\"anthropic-version\") ||\n        serverConfig.anthropicApiVersion ||\n        Anthropic.Vision,\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Anthropic as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Anthropic] filter`, e);\n    }\n  }\n  // console.log(\"[Anthropic request]\", fetchOptions.headers, req.method);\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // console.log(\n    //   \"[Anthropic response]\",\n    //   res.status,\n    //   \"   \",\n    //   res.headers,\n    //   res.url,\n    // );\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { BAIDU_OATUH_URL } from \"../constant\";\n/**\n * 使用 AK，SK 生成鉴权签名（Access Token）\n * @return 鉴权签名信息\n */\nexport async function getAccessToken(\n  clientId: string,\n  clientSecret: string,\n): Promise<{\n  access_token: string;\n  expires_in: number;\n  error?: number;\n}> {\n  const res = await fetch(\n    `${BAIDU_OATUH_URL}?grant_type=client_credentials&client_id=${clientId}&client_secret=${clientSecret}`,\n    {\n      method: \"POST\",\n      mode: \"cors\",\n    },\n  );\n  const resJson = await res.json();\n  return resJson;\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  BAIDU_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelAvailableInServer } from \"@/app/utils/model\";\nimport { getAccessToken } from \"@/app/utils/baidu\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Baidu Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Ernie);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  if (!serverConfig.baiduApiKey || !serverConfig.baiduSecretKey) {\n    return NextResponse.json(\n      {\n        error: true,\n        message: `missing BAIDU_API_KEY or BAIDU_SECRET_KEY in server env vars`,\n      },\n      {\n        status: 401,\n      },\n    );\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Baidu] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Baidu, \"\");\n\n  let baseUrl = serverConfig.baiduUrl || BAIDU_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const { access_token } = await getAccessToken(\n    serverConfig.baiduApiKey as string,\n    serverConfig.baiduSecretKey as string,\n  );\n  const fetchUrl = `${baseUrl}${path}?access_token=${access_token}`;\n\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Baidu as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Baidu] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  BYTEDANCE_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelAvailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[ByteDance Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Doubao);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[ByteDance] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.ByteDance, \"\");\n\n  let baseUrl = serverConfig.bytedanceUrl || BYTEDANCE_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.ByteDance as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[ByteDance] filter`, e);\n    }\n  }\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  ALIBABA_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelAvailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Alibaba Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Qwen);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Alibaba] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Alibaba, \"\");\n\n  let baseUrl = serverConfig.alibabaUrl || ALIBABA_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n      \"X-DashScope-SSE\": req.headers.get(\"X-DashScope-SSE\") ?? \"disable\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Alibaba as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Alibaba] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  MOONSHOT_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelAvailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Moonshot Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Moonshot);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Moonshot] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Moonshot, \"\");\n\n  let baseUrl = serverConfig.moonshotUrl || MOONSHOT_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Moonshot as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Moonshot] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSideConfig } from \"@/app/config/server\";\nimport { ModelProvider, STABILITY_BASE_URL } from \"@/app/constant\";\nimport { auth } from \"@/app/api/auth\";\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Stability] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const controller = new AbortController();\n\n  const serverConfig = getServerSideConfig();\n\n  let baseUrl = serverConfig.stabilityUrl || STABILITY_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  let path = `${req.nextUrl.pathname}`.replaceAll(\"/api/stability/\", \"\");\n\n  console.log(\"[Stability Proxy] \", path);\n  console.log(\"[Stability Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const authResult = auth(req, ModelProvider.Stability);\n\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  const bearToken = req.headers.get(\"Authorization\") ?? \"\";\n  const token = bearToken.trim().replaceAll(\"Bearer \", \"\").trim();\n\n  const key = token ? token : serverConfig.stabilityApiKey;\n\n  if (!key) {\n    return NextResponse.json(\n      {\n        error: true,\n        message: `missing STABILITY_API_KEY in server env vars`,\n      },\n      {\n        status: 401,\n      },\n    );\n  }\n\n  const fetchUrl = `${baseUrl}/${path}`;\n  console.log(\"[Stability Url] \", fetchUrl);\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": req.headers.get(\"Content-Type\") || \"multipart/form-data\",\n      Accept: req.headers.get(\"Accept\") || \"application/json\",\n      Authorization: `Bearer ${key}`,\n    },\n    method: req.method,\n    body: req.body,\n    // to fix #2485: https://stackoverflow.com/questions/55920957/cloudflare-worker-typeerror-one-time-use-body\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  IFLYTEK_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelAvailableInServer } from \"@/app/utils/model\";\n// iflytek\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Iflytek Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.Iflytek);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[Iflytek] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // iflytek use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.Iflytek, \"\");\n\n  let baseUrl = serverConfig.iflytekUrl || IFLYTEK_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.Iflytek as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[Iflytek] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  XAI_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelAvailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[XAI Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.XAI);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[XAI] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.XAI, \"\");\n\n  let baseUrl = serverConfig.xaiUrl || XAI_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.XAI as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[XAI] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { getServerSideConfig } from \"@/app/config/server\";\nimport {\n  CHATGLM_BASE_URL,\n  ApiPath,\n  ModelProvider,\n  ServiceProvider,\n} from \"@/app/constant\";\nimport { prettyObject } from \"@/app/utils/format\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { auth } from \"@/app/api/auth\";\nimport { isModelAvailableInServer } from \"@/app/utils/model\";\n\nconst serverConfig = getServerSideConfig();\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[GLM Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n\n  const authResult = auth(req, ModelProvider.ChatGLM);\n  if (authResult.error) {\n    return NextResponse.json(authResult, {\n      status: 401,\n    });\n  }\n\n  try {\n    const response = await request(req);\n    return response;\n  } catch (e) {\n    console.error(\"[GLM] \", e);\n    return NextResponse.json(prettyObject(e));\n  }\n}\n\nasync function request(req: NextRequest) {\n  const controller = new AbortController();\n\n  // alibaba use base url or just remove the path\n  let path = `${req.nextUrl.pathname}`.replaceAll(ApiPath.ChatGLM, \"\");\n\n  let baseUrl = serverConfig.chatglmUrl || CHATGLM_BASE_URL;\n\n  if (!baseUrl.startsWith(\"http\")) {\n    baseUrl = `https://${baseUrl}`;\n  }\n\n  if (baseUrl.endsWith(\"/\")) {\n    baseUrl = baseUrl.slice(0, -1);\n  }\n\n  console.log(\"[Proxy] \", path);\n  console.log(\"[Base Url]\", baseUrl);\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  const fetchUrl = `${baseUrl}${path}`;\n  console.log(\"[Fetch Url] \", fetchUrl);\n  const fetchOptions: RequestInit = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: req.headers.get(\"Authorization\") ?? \"\",\n    },\n    method: req.method,\n    body: req.body,\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  // #1815 try to refuse some request to some models\n  if (serverConfig.customModels && req.body) {\n    try {\n      const clonedBody = await req.text();\n      fetchOptions.body = clonedBody;\n\n      const jsonBody = JSON.parse(clonedBody) as { model?: string };\n\n      // not undefined and is false\n      if (\n        isModelAvailableInServer(\n          serverConfig.customModels,\n          jsonBody?.model as string,\n          ServiceProvider.ChatGLM as string,\n        )\n      ) {\n        return NextResponse.json(\n          {\n            error: true,\n            message: `you are not allowed to use ${jsonBody?.model} model`,\n          },\n          {\n            status: 403,\n          },\n        );\n      }\n    } catch (e) {\n      console.error(`[GLM] filter`, e);\n    }\n  }\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSideConfig } from \"@/app/config/server\";\n\nexport async function handle(\n  req: NextRequest,\n  { params }: { params: { path: string[] } },\n) {\n  console.log(\"[Proxy Route] params \", params);\n\n  if (req.method === \"OPTIONS\") {\n    return NextResponse.json({ body: \"OK\" }, { status: 200 });\n  }\n  const serverConfig = getServerSideConfig();\n\n  // remove path params from searchParams\n  req.nextUrl.searchParams.delete(\"path\");\n  req.nextUrl.searchParams.delete(\"provider\");\n\n  const subpath = params.path.join(\"/\");\n  const fetchUrl = `${req.headers.get(\n    \"x-base-url\",\n  )}/${subpath}?${req.nextUrl.searchParams.toString()}`;\n  const skipHeaders = [\"connection\", \"host\", \"origin\", \"referer\", \"cookie\"];\n  const headers = new Headers(\n    Array.from(req.headers.entries()).filter((item) => {\n      if (\n        item[0].indexOf(\"x-\") > -1 ||\n        item[0].indexOf(\"sec-\") > -1 ||\n        skipHeaders.includes(item[0])\n      ) {\n        return false;\n      }\n      return true;\n    }),\n  );\n  // if dalle3 use openai api key\n    const baseUrl = req.headers.get(\"x-base-url\");\n    if (baseUrl?.includes(\"api.openai.com\")) {\n      if (!serverConfig.apiKey) {\n        return NextResponse.json(\n          { error: \"OpenAI API key not configured\" },\n          { status: 500 },\n        );\n      }\n      headers.set(\"Authorization\", `Bearer ${serverConfig.apiKey}`);\n    }\n\n  const controller = new AbortController();\n  const fetchOptions: RequestInit = {\n    headers,\n    method: req.method,\n    body: req.body,\n    // to fix #2485: https://stackoverflow.com/questions/55920957/cloudflare-worker-typeerror-one-time-use-body\n    redirect: \"manual\",\n    // @ts-ignore\n    duplex: \"half\",\n    signal: controller.signal,\n  };\n\n  const timeoutId = setTimeout(\n    () => {\n      controller.abort();\n    },\n    10 * 60 * 1000,\n  );\n\n  try {\n    const res = await fetch(fetchUrl, fetchOptions);\n    // to prevent browser prompt for credentials\n    const newHeaders = new Headers(res.headers);\n    newHeaders.delete(\"www-authenticate\");\n    // to disable nginx buffering\n    newHeaders.set(\"X-Accel-Buffering\", \"no\");\n\n    // The latest version of the OpenAI API forced the content-encoding to be \"br\" in json response\n    // So if the streaming is disabled, we need to remove the content-encoding header\n    // Because Vercel uses gzip to compress the response, if we don't remove the content-encoding header\n    // The browser will try to decode the response with brotli and fail\n    newHeaders.delete(\"content-encoding\");\n\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: newHeaders,\n    });\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n","import { ApiPath } from \"@/app/constant\";\nimport { NextRequest } from \"next/server\";\nimport { handle as openaiHandler } from \"../../openai\";\nimport { handle as azureHandler } from \"../../azure\";\nimport { handle as googleHandler } from \"../../google\";\nimport { handle as anthropicHandler } from \"../../anthropic\";\nimport { handle as baiduHandler } from \"../../baidu\";\nimport { handle as bytedanceHandler } from \"../../bytedance\";\nimport { handle as alibabaHandler } from \"../../alibaba\";\nimport { handle as moonshotHandler } from \"../../moonshot\";\nimport { handle as stabilityHandler } from \"../../stability\";\nimport { handle as iflytekHandler } from \"../../iflytek\";\nimport { handle as xaiHandler } from \"../../xai\";\nimport { handle as chatglmHandler } from \"../../glm\";\nimport { handle as proxyHandler } from \"../../proxy\";\n\nasync function handle(\n  req: NextRequest,\n  { params }: { params: { provider: string; path: string[] } },\n) {\n  const apiPath = `/api/${params.provider}`;\n  console.log(`[${params.provider} Route] params `, params);\n  switch (apiPath) {\n    case ApiPath.Azure:\n      return azureHandler(req, { params });\n    case ApiPath.Google:\n      return googleHandler(req, { params });\n    case ApiPath.Anthropic:\n      return anthropicHandler(req, { params });\n    case ApiPath.Baidu:\n      return baiduHandler(req, { params });\n    case ApiPath.ByteDance:\n      return bytedanceHandler(req, { params });\n    case ApiPath.Alibaba:\n      return alibabaHandler(req, { params });\n    // case ApiPath.Tencent: using \"/api/tencent\"\n    case ApiPath.Moonshot:\n      return moonshotHandler(req, { params });\n    case ApiPath.Stability:\n      return stabilityHandler(req, { params });\n    case ApiPath.Iflytek:\n      return iflytekHandler(req, { params });\n    case ApiPath.XAI:\n      return xaiHandler(req, { params });\n    case ApiPath.ChatGLM:\n      return chatglmHandler(req, { params });\n    case ApiPath.OpenAI:\n      return openaiHandler(req, { params });\n    default:\n      return proxyHandler(req, { params });\n  }\n}\n\nexport const GET = handle;\nexport const POST = handle;\n\nexport const runtime = \"edge\";\nexport const preferredRegion = [\n  \"arn1\",\n  \"bom1\",\n  \"cdg1\",\n  \"cle1\",\n  \"cpt1\",\n  \"dub1\",\n  \"fra1\",\n  \"gru1\",\n  \"hnd1\",\n  \"iad1\",\n  \"icn1\",\n  \"kix1\",\n  \"lhr1\",\n  \"pdx1\",\n  \"sfo1\",\n  \"sin1\",\n  \"syd1\",\n];\n","import { AppRouteRouteModule } from \"next/dist/server/future/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/future/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"/Volumes/D/github/ChatGPT-Next-Web/app/api/[provider]/[...path]/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/[provider]/[...path]/route\",\n        pathname: \"/api/[provider]/[...path]\",\n        filename: \"route\",\n        bundlePath: \"app/api/[provider]/[...path]/route\"\n    },\n    resolvedPagePath: \"/Volumes/D/github/ChatGPT-Next-Web/app/api/[provider]/[...path]/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/[provider]/[...path]/route\";\nfunction patchFetch() {\n    return _patchFetch({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\nexport { routeModule, requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout, originalPathname, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","import { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2F%5Bprovider%5D%2F%5B...path%5D%2Froute&page=%2Fapi%2F%5Bprovider%5D%2F%5B...path%5D%2Froute&pagePath=private-next-app-dir%2Fapi%2F%5Bprovider%5D%2F%5B...path%5D%2Froute.ts&appDir=%2FVolumes%2FD%2Fgithub%2FChatGPT-Next-Web%2Fapp&appPaths=%2Fapi%2F%5Bprovider%5D%2F%5B...path%5D%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=arn1&preferredRegion=bom1&preferredRegion=cdg1&preferredRegion=cle1&preferredRegion=cpt1&preferredRegion=dub1&preferredRegion=fra1&preferredRegion=gru1&preferredRegion=hnd1&preferredRegion=iad1&preferredRegion=icn1&preferredRegion=kix1&preferredRegion=lhr1&preferredRegion=pdx1&preferredRegion=sfo1&preferredRegion=sin1&preferredRegion=syd1&middlewareConfig=e30%3D!private-next-app-dir/api/[provider]/[...path]/route.ts?__next_edge_ssr_entry__\";\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule);\n\n//# sourceMappingURL=edge-app-route.js.map","import { NextRequest } from \"next/server\";\nimport { getServerSideConfig } from \"../config/server\";\nimport md5 from \"spark-md5\";\nimport { ACCESS_CODE_PREFIX, ModelProvider } from \"../constant\";\n\nfunction getIP(req: NextRequest) {\n  let ip = req.ip ?? req.headers.get(\"x-real-ip\");\n  const forwardedFor = req.headers.get(\"x-forwarded-for\");\n\n  if (!ip && forwardedFor) {\n    ip = forwardedFor.split(\",\").at(0) ?? \"\";\n  }\n\n  return ip;\n}\n\nfunction parseApiKey(bearToken: string) {\n  const token = bearToken.trim().replaceAll(\"Bearer \", \"\").trim();\n  const isApiKey = !token.startsWith(ACCESS_CODE_PREFIX);\n\n  return {\n    accessCode: isApiKey ? \"\" : token.slice(ACCESS_CODE_PREFIX.length),\n    apiKey: isApiKey ? token : \"\",\n  };\n}\n\nexport function auth(req: NextRequest, modelProvider: ModelProvider) {\n  const authToken = req.headers.get(\"Authorization\") ?? \"\";\n\n  // check if it is openai api key or user token\n  const { accessCode, apiKey } = parseApiKey(authToken);\n\n  const hashedCode = md5.hash(accessCode ?? \"\").trim();\n\n  const serverConfig = getServerSideConfig();\n  console.log(\"[Auth] allowed hashed codes: \", [...serverConfig.codes]);\n  console.log(\"[Auth] got access code:\", accessCode);\n  console.log(\"[Auth] hashed access code:\", hashedCode);\n  console.log(\"[User IP] \", getIP(req));\n  console.log(\"[Time] \", new Date().toLocaleString());\n\n  if (serverConfig.needCode && !serverConfig.codes.has(hashedCode) && !apiKey) {\n    return {\n      error: true,\n      msg: !accessCode ? \"empty access code\" : \"wrong access code\",\n    };\n  }\n\n  if (serverConfig.hideUserApiKey && !!apiKey) {\n    return {\n      error: true,\n      msg: \"you are not allowed to access with your own api key\",\n    };\n  }\n\n  // if user does not provide an api key, inject system api key\n  if (!apiKey) {\n    const serverConfig = getServerSideConfig();\n\n    // const systemApiKey =\n    //   modelProvider === ModelProvider.GeminiPro\n    //     ? serverConfig.googleApiKey\n    //     : serverConfig.isAzure\n    //     ? serverConfig.azureApiKey\n    //     : serverConfig.apiKey;\n\n    let systemApiKey: string | undefined;\n\n    switch (modelProvider) {\n      case ModelProvider.Stability:\n        systemApiKey = serverConfig.stabilityApiKey;\n        break;\n      case ModelProvider.GeminiPro:\n        systemApiKey = serverConfig.googleApiKey;\n        break;\n      case ModelProvider.Claude:\n        systemApiKey = serverConfig.anthropicApiKey;\n        break;\n      case ModelProvider.Doubao:\n        systemApiKey = serverConfig.bytedanceApiKey;\n        break;\n      case ModelProvider.Ernie:\n        systemApiKey = serverConfig.baiduApiKey;\n        break;\n      case ModelProvider.Qwen:\n        systemApiKey = serverConfig.alibabaApiKey;\n        break;\n      case ModelProvider.Moonshot:\n        systemApiKey = serverConfig.moonshotApiKey;\n        break;\n      case ModelProvider.Iflytek:\n        systemApiKey =\n          serverConfig.iflytekApiKey + \":\" + serverConfig.iflytekApiSecret;\n        break;\n      case ModelProvider.XAI:\n        systemApiKey = serverConfig.xaiApiKey;\n        break;\n      case ModelProvider.ChatGLM:\n        systemApiKey = serverConfig.chatglmApiKey;\n        break;\n      case ModelProvider.GPT:\n      default:\n        if (req.nextUrl.pathname.includes(\"azure/deployments\")) {\n          systemApiKey = serverConfig.azureApiKey;\n        } else {\n          systemApiKey = serverConfig.apiKey;\n        }\n    }\n\n    if (systemApiKey) {\n      console.log(\"[Auth] use system api key\");\n      req.headers.set(\"Authorization\", `Bearer ${systemApiKey}`);\n    } else {\n      console.log(\"[Auth] admin did not provide an api key\");\n    }\n  } else {\n    console.log(\"[Auth] use user api key\");\n  }\n\n  return {\n    error: false,\n  };\n}\n","export function prettyObject(msg: any) {\n  const obj = msg;\n  if (typeof msg !== \"string\") {\n    msg = JSON.stringify(msg, null, \"  \");\n  }\n  if (msg === \"{}\") {\n    return obj.toString();\n  }\n  if (msg.startsWith(\"```json\")) {\n    return msg;\n  }\n  return [\"```json\", msg, \"```\"].join(\"\\n\");\n}\n\nexport function* chunks(s: string, maxBytes = 1000 * 1000) {\n  const decoder = new TextDecoder(\"utf-8\");\n  let buf = new TextEncoder().encode(s);\n  while (buf.length) {\n    let i = buf.lastIndexOf(32, maxBytes + 1);\n    // If no space found, try forward search\n    if (i < 0) i = buf.indexOf(32, maxBytes);\n    // If there's no space at all, take all\n    if (i < 0) i = buf.length;\n    // This is a safe cut-off point; never half-way a multi-byte\n    yield decoder.decode(buf.slice(0, i));\n    buf = buf.slice(i + 1); // Skip space (if any)\n  }\n}\n"],"names":["module","exports","require","cloudflareAIGatewayUrl","fetchUrl","paths","split","slice","concat","join","CustomSeq","val","cache","Map","next","has","id","get","seq","set","customProvider","providerName","toLowerCase","providerType","sorted","getModelProvider","modelWithProvider","model","provider","isModelAvailableInServer","customModels","modelName","fullName","modelTable","collectModelTable","models","forEach","m","name","displayName","filter","v","length","available","startsWith","nameConfig","Object","values","customModelName","customProviderName","count","undefined","DEFAULT_MODELS","serverConfig","getServerSideConfig","requestOpenai","req","controller","AbortController","isAzure","nextUrl","pathname","includes","authValue","authHeaderName","headers","trim","replaceAll","path","baseUrl","azureUrl","OPENAI_BASE_URL","endsWith","console","log","timeoutId","setTimeout","abort","azureApiVersion","searchParams","shift","realDeployName","_","deployId","fetchOptions","openaiOrgId","method","body","redirect","duplex","signal","clonedBody","text","jsonBody","JSON","parse","ServiceProvider","OpenAI","Azure","NextResponse","json","error","message","status","e","res","fetch","openaiOrganizationHeader","newHeaders","Headers","delete","Response","statusText","clearTimeout","ALLOWED_PATH","Set","OpenaiPath","handle","params","subpath","msg","authResult","auth","ModelProvider","GPT","response","ListModelPath","remoteModelRes","availableModels","config","disableGPT4","data","prettyObject","GeminiPro","apiKey","token","googleApiKey","request","googleUrl","GEMINI_BASE_URL","ApiPath","Google","replace","ALLOWD_PATH","Anthropic","ChatPath","ChatPath1","Claude","anthropicApiKey","anthropicUrl","ANTHROPIC_BASE_URL","anthropicApiVersion","Vision","getAccessToken","clientId","clientSecret","BAIDU_OATUH_URL","mode","Ernie","baiduApiKey","baiduSecretKey","Baidu","baiduUrl","BAIDU_BASE_URL","access_token","Doubao","ByteDance","bytedanceUrl","BYTEDANCE_BASE_URL","Authorization","Qwen","Alibaba","alibabaUrl","ALIBABA_BASE_URL","Moonshot","moonshotUrl","MOONSHOT_BASE_URL","stabilityUrl","STABILITY_BASE_URL","Stability","key","stabilityApiKey","Accept","Iflytek","iflytekUrl","IFLYTEK_BASE_URL","XAI","xaiUrl","XAI_BASE_URL","ChatGLM","chatglmUrl","CHATGLM_BASE_URL","toString","skipHeaders","Array","from","entries","item","indexOf","apiPath","azureHandler","googleHandler","anthropicHandler","baiduHandler","bytedanceHandler","alibabaHandler","moonshotHandler","stabilityHandler","iflytekHandler","xaiHandler","chatglmHandler","openaiHandler","proxyHandler","GET","POST","runtime","preferredRegion","routeModule","module_compiled","AppRouteRouteModule","definition","kind","route_kind","x","APP_ROUTE","page","filename","bundlePath","resolvedPagePath","nextConfigOutput","userland","route_namespaceObject","requestAsyncStorage","staticGenerationAsyncStorage","serverHooks","headerHooks","staticGenerationBailout","originalPathname","patchFetch","patch_fetch","XH","ComponentMod","route_next_edge_ssr_entry_namespaceObject","next_edge_app_route_loaderabsolutePagePath_private_next_app_dir_2Fapi_2F_5Bprovider_5D_2F_5B_path_5D_2Froute_ts_page_2Fapi_2F_5Bprovider_5D_2F_5B_path_5D_2Froute_appDirLoader_bmV4dC1hcHAtbG9hZGVyP25hbWU9YXBwJTJGYXBpJTJGJTVCcHJvdmlkZXIlNUQlMkYlNUIuLi5wYXRoJTVEJTJGcm91dGUmcGFnZT0lMkZhcGklMkYlNUJwcm92aWRlciU1RCUyRiU1Qi4uLnBhdGglNUQlMkZyb3V0ZSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRiU1QnByb3ZpZGVyJTVEJTJGJTVCLi4ucGF0aCU1RCUyRnJvdXRlLnRzJmFwcERpcj0lMkZWb2x1bWVzJTJGRCUyRmdpdGh1YiUyRkNoYXRHUFQtTmV4dC1XZWIlMkZhcHAmYXBwUGF0aHM9JTJGYXBpJTJGJTVCcHJvdmlkZXIlNUQlMkYlNUIuLi5wYXRoJTVEJTJGcm91dGUmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249YXJuMSZwcmVmZXJyZWRSZWdpb249Ym9tMSZwcmVmZXJyZWRSZWdpb249Y2RnMSZwcmVmZXJyZWRSZWdpb249Y2xlMSZwcmVmZXJyZWRSZWdpb249Y3B0MSZwcmVmZXJyZWRSZWdpb249ZHViMSZwcmVmZXJyZWRSZWdpb249ZnJhMSZwcmVmZXJyZWRSZWdpb249Z3J1MSZwcmVmZXJyZWRSZWdpb249aG5kMSZwcmVmZXJyZWRSZWdpb249aWFkMSZwcmVmZXJyZWRSZWdpb249aWNuMSZwcmVmZXJyZWRSZWdpb249a2l4MSZwcmVmZXJyZWRSZWdpb249bGhyMSZwcmVmZXJyZWRSZWdpb249cGR4MSZwcmVmZXJyZWRSZWdpb249c2ZvMSZwcmVmZXJyZWRSZWdpb249c2luMSZwcmVmZXJyZWRSZWdpb249c3lkMSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCE_3D_nextConfigOutput_standalone_preferredRegion_arn1_preferredRegion_bom1_preferredRegion_cdg1_preferredRegion_cle1_preferredRegion_cpt1_preferredRegion_dub1_preferredRegion_fra1_preferredRegion_gru1_preferredRegion_hnd1_preferredRegion_iad1_preferredRegion_icn1_preferredRegion_kix1_preferredRegion_lhr1_preferredRegion_pdx1_preferredRegion_sfo1_preferredRegion_sin1_preferredRegion_syd1_middlewareConfig_e30_3D_","edge_route_module_wrapper","a","wrap","modelProvider","accessCode","parseApiKey","bearToken","isApiKey","ACCESS_CODE_PREFIX","hashedCode","md5","codes","getIP","ip","forwardedFor","at","Date","toLocaleString","needCode","hideUserApiKey","systemApiKey","bytedanceApiKey","alibabaApiKey","moonshotApiKey","iflytekApiKey","iflytekApiSecret","xaiApiKey","chatglmApiKey","azureApiKey","obj","stringify"],"sourceRoot":""}