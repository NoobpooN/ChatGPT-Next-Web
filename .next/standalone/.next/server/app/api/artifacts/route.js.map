{"version":3,"file":"app/api/artifacts/route.js","mappings":"mFAAAA,CAAAA,EAAAC,OAAA,CAAAC,QAAA,0CCAAF,CAAAA,EAAAC,OAAA,CAAAC,QAAA,6bCIA,eAAeC,EAAOC,CAAgB,CAAEC,CAAiB,EACvD,IAAMC,EAAeC,CAAAA,EAAAA,EAAAA,CAAAA,IACfC,EAAW,IACf,CAAC,8CAA8C,EAAEF,EAAaG,mBAAmB,CAAC,uBAAuB,EAAEH,EAAaI,uBAAuB,CAAC,CAAC,CAC7IC,EAAe,IAAO,EAC1BC,cAAe,CAAC,OAAO,EAAEN,EAAaO,kBAAkB,CAAC,CAAC,CAC5D,EACA,GAAIT,SAAAA,EAAIU,MAAM,CAAa,CACzB,IAAMC,EAAa,MAAMX,EAAIY,IAAI,GAC3BC,EAAaC,IAAAA,IAAQ,CAACH,GAAYI,IAAI,GACtCC,EAIF,CACFC,IAAKJ,EACLK,MAAOP,CACT,EACA,GAAI,CACF,IAAMQ,EAAMC,SAASlB,EAAamB,eAAe,EAC7CF,EAAM,IACRH,CAAAA,EAAK,cAAiB,CAAGG,CAAAA,CAE7B,CAAE,MAAOG,EAAG,CACVC,QAAQC,KAAK,CAACF,EAChB,CACA,IAAMrB,EAAM,MAAMwB,MAAM,CAAC,EAAErB,IAAW,KAAK,CAAC,CAAE,CAC5CsB,QAAS,CACP,GAAGnB,GAAc,CACjB,eAAgB,kBAClB,EACAG,OAAQ,MACRM,KAAMW,KAAKC,SAAS,CAAC,CAACZ,EAAK,CAC7B,GACMa,EAAS,MAAM5B,EAAI6B,IAAI,SAE7B,CADAP,QAAQQ,GAAG,CAAC,YAAaF,GACrBA,GAAQG,SACHC,EAAAA,EAAYA,CAACH,IAAI,CACtB,CAAEI,KAAM,EAAGC,GAAItB,EAAYgB,OAAAA,CAAO,EAClC,CAAEO,OAAQnC,EAAImC,MAAM,GAGjBH,EAAAA,EAAYA,CAACH,IAAI,CACtB,CAAEN,MAAO,GAAMa,IAAK,iBAAkB,EACtC,CAAED,OAAQ,GAAI,EAElB,CACA,GAAIpC,QAAAA,EAAIU,MAAM,CAAY,CACxB,IAAMyB,EAAKnC,GAAKsC,SAASC,cAAcC,IAAI,MACrCvC,EAAM,MAAMwB,MAAM,CAAC,EAAErB,IAAW,QAAQ,EAAE+B,EAAG,CAAC,CAAE,CACpDT,QAASnB,IACTG,OAAQ,KACV,GACA,OAAO,IAAI+B,SAASxC,EAAIe,IAAI,CAAE,CAC5BoB,OAAQnC,EAAImC,MAAM,CAClBM,WAAYzC,EAAIyC,UAAU,CAC1BhB,QAASzB,EAAIyB,OAAO,EAExB,CACA,OAAOO,EAAAA,EAAYA,CAACH,IAAI,CACtB,CAAEN,MAAO,GAAMa,IAAK,iBAAkB,EACtC,CAAED,OAAQ,GAAI,EAElB,CAEO,IAAMO,EAAO5C,EACP6C,EAAM7C,EAEN8C,EAAU,OCjEvBC,EAAA,IAAwBC,EAAAC,mBAAmB,EAC3CC,WAAA,CACAC,KAAcC,EAAAC,CAAS,CAAAC,SAAA,CACvBC,KAAA,uBACAC,SAAA,iBACAC,SAAA,QACAC,WAAA,yBACA,EACAC,iBAAA,gEACAC,iBAVA,aAWAC,SAAYC,CACZ,GAIA,CAAQC,oBAAAA,CAAA,CAAAC,6BAAAA,CAAA,CAAAC,YAAAA,CAAA,CAAAC,YAAAA,CAAA,CAAAC,wBAAAA,CAAA,EAAuGpB,EAC/GqB,EAAA,uBACA,SAAAC,IACA,MAAW,GAAAC,EAAAC,EAAA,EAAW,CACtBN,YAAAA,EACAD,6BAAAA,CACA,EACA,CC1BO,IAAAQ,EAAqBC,EAC5BC,EAAeC,EAAAC,CAAsB,CAAAC,IAAA,CAAM9B","sources":["webpack://_N_E/external commonjs \"node:async_hooks\"","webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/./app/api/artifacts/route.ts","webpack://_N_E/./app/api/artifacts/route.ts?cb63","webpack://_N_E/?921f","webpack://_N_E/<anon>"],"sourcesContent":["module.exports = require(\"node:async_hooks\");","module.exports = require(\"node:buffer\");","import md5 from \"spark-md5\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { getServerSideConfig } from \"@/app/config/server\";\n\nasync function handle(req: NextRequest, res: NextResponse) {\n  const serverConfig = getServerSideConfig();\n  const storeUrl = () =>\n    `https://api.cloudflare.com/client/v4/accounts/${serverConfig.cloudflareAccountId}/storage/kv/namespaces/${serverConfig.cloudflareKVNamespaceId}`;\n  const storeHeaders = () => ({\n    Authorization: `Bearer ${serverConfig.cloudflareKVApiKey}`,\n  });\n  if (req.method === \"POST\") {\n    const clonedBody = await req.text();\n    const hashedCode = md5.hash(clonedBody).trim();\n    const body: {\n      key: string;\n      value: string;\n      expiration_ttl?: number;\n    } = {\n      key: hashedCode,\n      value: clonedBody,\n    };\n    try {\n      const ttl = parseInt(serverConfig.cloudflareKVTTL as string);\n      if (ttl > 60) {\n        body[\"expiration_ttl\"] = ttl;\n      }\n    } catch (e) {\n      console.error(e);\n    }\n    const res = await fetch(`${storeUrl()}/bulk`, {\n      headers: {\n        ...storeHeaders(),\n        \"Content-Type\": \"application/json\",\n      },\n      method: \"PUT\",\n      body: JSON.stringify([body]),\n    });\n    const result = await res.json();\n    console.log(\"save data\", result);\n    if (result?.success) {\n      return NextResponse.json(\n        { code: 0, id: hashedCode, result },\n        { status: res.status },\n      );\n    }\n    return NextResponse.json(\n      { error: true, msg: \"Save data error\" },\n      { status: 400 },\n    );\n  }\n  if (req.method === \"GET\") {\n    const id = req?.nextUrl?.searchParams?.get(\"id\");\n    const res = await fetch(`${storeUrl()}/values/${id}`, {\n      headers: storeHeaders(),\n      method: \"GET\",\n    });\n    return new Response(res.body, {\n      status: res.status,\n      statusText: res.statusText,\n      headers: res.headers,\n    });\n  }\n  return NextResponse.json(\n    { error: true, msg: \"Invalid request\" },\n    { status: 400 },\n  );\n}\n\nexport const POST = handle;\nexport const GET = handle;\n\nexport const runtime = \"edge\";\n","import { AppRouteRouteModule } from \"next/dist/server/future/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/future/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"/Volumes/D/github/ChatGPT-Next-Web/app/api/artifacts/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/artifacts/route\",\n        pathname: \"/api/artifacts\",\n        filename: \"route\",\n        bundlePath: \"app/api/artifacts/route\"\n    },\n    resolvedPagePath: \"/Volumes/D/github/ChatGPT-Next-Web/app/api/artifacts/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/artifacts/route\";\nfunction patchFetch() {\n    return _patchFetch({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\nexport { routeModule, requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout, originalPathname, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","import { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2Fartifacts%2Froute&page=%2Fapi%2Fartifacts%2Froute&pagePath=private-next-app-dir%2Fapi%2Fartifacts%2Froute.ts&appDir=%2FVolumes%2FD%2Fgithub%2FChatGPT-Next-Web%2Fapp&appPaths=%2Fapi%2Fartifacts%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!private-next-app-dir/api/artifacts/route.ts?__next_edge_ssr_entry__\";\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule);\n\n//# sourceMappingURL=edge-app-route.js.map"],"names":["module","exports","require","handle","req","res","serverConfig","getServerSideConfig","storeUrl","cloudflareAccountId","cloudflareKVNamespaceId","storeHeaders","Authorization","cloudflareKVApiKey","method","clonedBody","text","hashedCode","md5","trim","body","key","value","ttl","parseInt","cloudflareKVTTL","e","console","error","fetch","headers","JSON","stringify","result","json","log","success","NextResponse","code","id","status","msg","nextUrl","searchParams","get","Response","statusText","POST","GET","runtime","routeModule","module_compiled","AppRouteRouteModule","definition","kind","route_kind","x","APP_ROUTE","page","pathname","filename","bundlePath","resolvedPagePath","nextConfigOutput","userland","route_namespaceObject","requestAsyncStorage","staticGenerationAsyncStorage","serverHooks","headerHooks","staticGenerationBailout","originalPathname","patchFetch","patch_fetch","XH","ComponentMod","route_next_edge_ssr_entry_namespaceObject","next_edge_app_route_loaderabsolutePagePath_private_next_app_dir_2Fapi_2Fartifacts_2Froute_ts_page_2Fapi_2Fartifacts_2Froute_appDirLoader_bmV4dC1hcHAtbG9hZGVyP25hbWU9YXBwJTJGYXBpJTJGYXJ0aWZhY3RzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhcnRpZmFjdHMlMkZyb3V0ZSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmFydGlmYWN0cyUyRnJvdXRlLnRzJmFwcERpcj0lMkZWb2x1bWVzJTJGRCUyRmdpdGh1YiUyRkNoYXRHUFQtTmV4dC1XZWIlMkZhcHAmYXBwUGF0aHM9JTJGYXBpJTJGYXJ0aWZhY3RzJTJGcm91dGUmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEIQ_3D_3D_nextConfigOutput_standalone_preferredRegion_middlewareConfig_e30_3D_","edge_route_module_wrapper","a","wrap"],"sourceRoot":""}