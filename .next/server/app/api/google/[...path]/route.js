(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[353],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},2573:(e,o,t)=>{"use strict";t.r(o),t.d(o,{ComponentMod:()=>U,default:()=>w});var a={};t.r(a),t.d(a,{GET:()=>v,POST:()=>m,preferredRegion:()=>_,runtime:()=>b});var r={};t.r(r),t.d(r,{headerHooks:()=>O,originalPathname:()=>B,patchFetch:()=>C,requestAsyncStorage:()=>k,routeModule:()=>E,serverHooks:()=>I,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>P});var s=t(7875),n=t(8381),i=t(2251),p=t(9845),l=t(572),c=t(5577),d=t(9579),u=t(7736),h=t(1480);let g=(0,d.g)();async function A(e,{params:o}){if(console.log("[Google Route] params ",o),"OPTIONS"===e.method)return l.xk.json({body:"OK"},{status:200});let t=(0,c.I)(e,u.k8.GeminiPro);if(t.error)return l.xk.json(t,{status:401});let a=(e.headers.get("Authorization")??"").trim().replaceAll("Bearer ","").trim()||g.googleApiKey;if(!a)return l.xk.json({error:!0,message:"missing GOOGLE_API_KEY in server env vars"},{status:401});try{return await y(e,a)}catch(e){return console.error("[Google] ",e),l.xk.json((0,h.B)(e))}}let v=A,m=A,b="edge",_=["bom1","cle1","cpt1","gru1","hnd1","iad1","icn1","kix1","pdx1","sfo1","sin1","syd1"];async function y(e,o){let t=new AbortController,a=g.googleUrl||u.Hm,r=`${e.nextUrl.pathname}`.replaceAll(u.L.Google,"");a.startsWith("http")||(a=`https://${a}`),a.endsWith("/")&&(a=a.slice(0,-1)),console.log("[Proxy] ",r),console.log("[Base Url]",a);let s=setTimeout(()=>{t.abort()},6e5),n=`${a}${r}?key=${o}${e?.nextUrl?.searchParams?.get("alt")==="sse"?"&alt=sse":""}`;console.log("[Fetch Url] ",n);let i={headers:{"Content-Type":"application/json","Cache-Control":"no-store"},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};try{let e=await fetch(n,i),o=new Headers(e.headers);return o.delete("www-authenticate"),o.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:o})}finally{clearTimeout(s)}}let E=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/google/[...path]/route",pathname:"/api/google/[...path]",filename:"route",bundlePath:"app/api/google/[...path]/route"},resolvedPagePath:"/Volumes/D/github/ChatGPT-Next-Web/app/api/google/[...path]/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:k,staticGenerationAsyncStorage:f,serverHooks:I,headerHooks:O,staticGenerationBailout:P}=E,B="/api/google/[...path]/route";function C(){return(0,p.XH)({serverHooks:I,staticGenerationAsyncStorage:f})}let U=r,w=s.a.wrap(E)},5577:(e,o,t)=>{"use strict";t.d(o,{I:()=>i});var a=t(9579),r=t(5045),s=t.n(r),n=t(7736);function i(e,o){let{accessCode:t,apiKey:r}=function(e){let o=e.trim().replaceAll("Bearer ","").trim(),t=!o.startsWith(n.TW);return{accessCode:t?"":o.slice(n.TW.length),apiKey:t?o:""}}(e.headers.get("Authorization")??""),i=s().hash(t??"").trim(),p=(0,a.g)();if(console.log("[Auth] allowed hashed codes: ",[...p.codes]),console.log("[Auth] got access code:",t),console.log("[Auth] hashed access code:",i),console.log("[User IP] ",function(e){let o=e.ip??e.headers.get("x-real-ip"),t=e.headers.get("x-forwarded-for");return!o&&t&&(o=t.split(",").at(0)??""),o}(e)),console.log("[Time] ",new Date().toLocaleString()),p.needCode&&!p.codes.has(i)&&!r)return{error:!0,msg:t?"wrong access code":"empty access code"};if(p.hideUserApiKey&&r)return{error:!0,msg:"you are not allowed to access with your own api key"};if(r)console.log("[Auth] use user api key");else{let t;let r=(0,a.g)();switch(o){case n.k8.GeminiPro:t=r.googleApiKey;break;case n.k8.Claude:t=r.anthropicApiKey;break;case n.k8.Doubao:t=r.bytedanceApiKey;break;case n.k8.Ernie:t=r.baiduApiKey;break;case n.k8.Qwen:t=r.alibabaApiKey;break;case n.k8.GPT:default:t=e.nextUrl.pathname.includes("azure/deployments")?r.azureApiKey:r.apiKey}t?(console.log("[Auth] use system api key"),e.headers.set("Authorization",`Bearer ${t}`)):console.log("[Auth] admin did not provide an api key")}return{error:!1}}},9579:(e,o,t)=>{"use strict";t.d(o,{g:()=>p});var a=t(5045),r=t.n(a),s=t(7736);let n=function(){let e=process.env.CODE;try{let o=(e?.split(",")??[]).filter(e=>!!e).map(e=>r().hash(e.trim()));return new Set(o)}catch(e){return new Set}}();function i(e){let o=(e??"").split(",").map(e=>e.trim()),t=Math.floor(Math.random()*o.length),a=o[t];return a&&console.log(`[Server Config] using ${t+1} of ${o.length} api key - ${a}`),a}let p=()=>{if("undefined"==typeof process)throw Error("[Server Config] you are importing a nodejs-only module outside of nodejs");let e=!!process.env.DISABLE_GPT4,o=process.env.CUSTOM_MODELS??"",t=process.env.DEFAULT_MODEL??"";e&&(o&&(o+=","),o+=s.Fv.filter(e=>e.name.startsWith("gpt-4")).map(e=>"-"+e.name).join(","),t.startsWith("gpt-4")&&(t=""));let a=!!process.env.AZURE_URL,r=!!process.env.GOOGLE_API_KEY,p=!!process.env.ANTHROPIC_API_KEY,l=!!process.env.BAIDU_API_KEY,c=!!process.env.BYTEDANCE_API_KEY,d=!!process.env.ALIBABA_API_KEY,u=(process.env.WHITE_WEBDEV_ENDPOINTS??"").split(",");return{baseUrl:process.env.BASE_URL,apiKey:i(process.env.OPENAI_API_KEY),openaiOrgId:process.env.OPENAI_ORG_ID,isAzure:a,azureUrl:process.env.AZURE_URL,azureApiKey:i(process.env.AZURE_API_KEY),azureApiVersion:process.env.AZURE_API_VERSION,isGoogle:r,googleApiKey:i(process.env.GOOGLE_API_KEY),googleUrl:process.env.GOOGLE_URL,isAnthropic:p,anthropicApiKey:i(process.env.ANTHROPIC_API_KEY),anthropicApiVersion:process.env.ANTHROPIC_API_VERSION,anthropicUrl:process.env.ANTHROPIC_URL,isBaidu:l,baiduUrl:process.env.BAIDU_URL,baiduApiKey:i(process.env.BAIDU_API_KEY),baiduSecretKey:process.env.BAIDU_SECRET_KEY,isBytedance:c,bytedanceApiKey:i(process.env.BYTEDANCE_API_KEY),bytedanceUrl:process.env.BYTEDANCE_URL,isAlibaba:d,alibabaUrl:process.env.ALIBABA_URL,alibabaApiKey:i(process.env.ALIBABA_API_KEY),gtmId:process.env.GTM_ID,needCode:n.size>0,code:process.env.CODE,codes:n,proxyUrl:process.env.PROXY_URL,isVercel:!!process.env.VERCEL,hideUserApiKey:!!process.env.HIDE_USER_API_KEY,disableGPT4:e,hideBalanceQuery:!process.env.ENABLE_BALANCE_QUERY,disableFastLink:!!process.env.DISABLE_FAST_LINK,customModels:o,defaultModel:t,allowedWebDevEndpoints:u}}},7736:(e,o,t)=>{"use strict";var a,r,s,n,i,p,l,c;t.d(o,{Bi:()=>d,FR:()=>A,Fv:()=>f,Hm:()=>h,L:()=>r,NU:()=>I,TW:()=>b,UT:()=>p,Uf:()=>_,YU:()=>y,ik:()=>v,k8:()=>c,mX:()=>E,n9:()=>g,x5:()=>m,y3:()=>u});let d="https://api.openai.com",u="https://api.anthropic.com",h="https://generativelanguage.googleapis.com/",g="https://aip.baidubce.com",A=`${g}/oauth/2.0/token`,v="https://ark.cn-beijing.volces.com",m="https://dashscope.aliyuncs.com/api/";!function(e){e.Home="/",e.Chat="/chat",e.Settings="/settings",e.NewChat="/new-chat",e.Masks="/masks",e.Auth="/auth"}(a||(a={})),function(e){e.Cors="",e.Azure="/api/azure",e.OpenAI="/api/openai",e.Anthropic="/api/anthropic",e.Google="/api/google",e.Baidu="/api/baidu",e.ByteDance="/api/bytedance",e.Alibaba="/api/alibaba"}(r||(r={})),function(e){e.AppBody="app-body",e.CustomModel="custom-model"}(s||(s={})),function(e){e.Masks="masks.json",e.Prompts="prompts.json"}(n||(n={})),function(e){e.Chat="chat-next-web-store",e.Access="access-control",e.Config="app-config",e.Mask="mask-store",e.Prompt="prompt-store",e.Update="chat-update",e.Sync="sync"}(i||(i={}));let b="nk-",_="chatgpt-next-web";!function(e){e.OpenAI="OpenAI",e.Azure="Azure",e.Google="Google",e.Anthropic="Anthropic",e.Baidu="Baidu",e.ByteDance="ByteDance",e.Alibaba="Alibaba"}(p||(p={})),function(e){e.BLOCK_NONE="BLOCK_NONE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE"}(l||(l={})),function(e){e.GPT="GPT",e.GeminiPro="GeminiPro",e.Claude="Claude",e.Ernie="Ernie",e.Doubao="Doubao",e.Qwen="Qwen"}(c||(c={}));let y={ChatPath:"v1/messages",ChatPath1:"v1/complete",ExampleEndpoint:"https://api.anthropic.com",Vision:"2023-06-01"},E={ChatPath:"v1/chat/completions",UsagePath:"dashboard/billing/usage",SubsPath:"dashboard/billing/subscription",ListModelPath:"v1/models"},k=["gpt-3.5-turbo","gpt-3.5-turbo-1106","gpt-3.5-turbo-0125","gpt-4","gpt-4-0613","gpt-4-32k","gpt-4-32k-0613","gpt-4-turbo","gpt-4-turbo-preview","gpt-4o","gpt-4o-2024-05-13","gpt-4o-mini","gpt-4o-mini-2024-07-18","gpt-4-vision-preview","gpt-4-turbo-2024-04-09","gpt-4-1106-preview"],f=[...k.map(e=>({name:e,available:!0,provider:{id:"openai",providerName:"OpenAI",providerType:"openai"}})),...k.map(e=>({name:e,available:!0,provider:{id:"azure",providerName:"Azure",providerType:"azure"}})),...["gemini-1.0-pro","gemini-1.5-pro-latest","gemini-1.5-flash-latest","gemini-pro-vision"].map(e=>({name:e,available:!0,provider:{id:"google",providerName:"Google",providerType:"google"}})),...["claude-instant-1.2","claude-2.0","claude-2.1","claude-3-sonnet-20240229","claude-3-opus-20240229","claude-3-haiku-20240307","claude-3-5-sonnet-20240620"].map(e=>({name:e,available:!0,provider:{id:"anthropic",providerName:"Anthropic",providerType:"anthropic"}})),...["ernie-4.0-turbo-8k","ernie-4.0-8k","ernie-4.0-8k-preview","ernie-4.0-8k-preview-0518","ernie-4.0-8k-latest","ernie-3.5-8k","ernie-3.5-8k-0205","ernie-speed-128k","ernie-speed-8k","ernie-lite-8k","ernie-tiny-8k"].map(e=>({name:e,available:!0,provider:{id:"baidu",providerName:"Baidu",providerType:"baidu"}})),...["Doubao-lite-4k","Doubao-lite-32k","Doubao-lite-128k","Doubao-pro-4k","Doubao-pro-32k","Doubao-pro-128k"].map(e=>({name:e,available:!0,provider:{id:"bytedance",providerName:"ByteDance",providerType:"bytedance"}})),...["qwen-turbo","qwen-plus","qwen-max","qwen-max-0428","qwen-max-0403","qwen-max-0107","qwen-max-longcontext"].map(e=>({name:e,available:!0,provider:{id:"alibaba",providerName:"Alibaba",providerType:"alibaba"}}))],I=["https://dav.jianguoyun.com/dav/","https://dav.dropdav.com/","https://dav.box.com/dav","https://nanao.teracloud.jp/dav/","https://bora.teracloud.jp/dav/","https://webdav.4shared.com/","https://dav.idrivesync.com","https://webdav.yandex.com","https://app.koofr.net/dav/Koofr"]},1480:(e,o,t)=>{"use strict";function a(e){let o=e;return("string"!=typeof e&&(e=JSON.stringify(e,null,"  ")),"{}"===e)?o.toString():e.startsWith("```json")?e:["```json",e,"```"].join("\n")}t.d(o,{B:()=>a})}},e=>{var o=o=>e(e.s=o);e.O(0,[297,45],()=>o(2573));var t=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/google/[...path]/route"]=t}]);
//# sourceMappingURL=route.js.map