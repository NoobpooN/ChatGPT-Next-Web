(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[650],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},1693:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ComponentMod:()=>N,default:()=>S});var o={};a.r(o),a.d(o,{GET:()=>m,POST:()=>g,preferredRegion:()=>w,runtime:()=>x});var r={};a.r(r),a.d(r,{headerHooks:()=>A,originalPathname:()=>O,patchFetch:()=>R,requestAsyncStorage:()=>E,routeModule:()=>T,serverHooks:()=>_,staticGenerationAsyncStorage:()=>P,staticGenerationBailout:()=>B});var n=a(7875),s=a(8381),u=a(2251),i=a(9845),l=a(9579),d=a(7736),c=a(1480),p=a(572),h=a(5577),y=a(413);let f=(0,l.g)();async function b(e,{params:t}){if(console.log("[ByteDance Route] params ",t),"OPTIONS"===e.method)return p.xk.json({body:"OK"},{status:200});let a=(0,h.I)(e,d.k8.Doubao);if(a.error)return p.xk.json(a,{status:401});try{return await k(e)}catch(e){return console.error("[ByteDance] ",e),p.xk.json((0,c.B)(e))}}let m=b,g=b,x="edge",w=["arn1","bom1","cdg1","cle1","cpt1","dub1","fra1","gru1","hnd1","iad1","icn1","kix1","lhr1","pdx1","sfo1","sin1","syd1"];async function k(e){let t=new AbortController,a=`${e.nextUrl.pathname}`.replaceAll(d.L.ByteDance,""),o=f.bytedanceUrl||d.ik;o.startsWith("http")||(o=`https://${o}`),o.endsWith("/")&&(o=o.slice(0,-1)),console.log("[Proxy] ",a),console.log("[Base Url]",o);let r=setTimeout(()=>{t.abort()},6e5),n=`${o}${a}`,s={headers:{"Content-Type":"application/json",Authorization:e.headers.get("Authorization")??""},method:e.method,body:e.body,redirect:"manual",duplex:"half",signal:t.signal};if(f.customModels&&e.body)try{let t=await e.text();s.body=t;let a=JSON.parse(t);if((0,y.pw)(f.customModels,a?.model,d.UT.ByteDance))return p.xk.json({error:!0,message:`you are not allowed to use ${a?.model} model`},{status:403})}catch(e){console.error("[ByteDance] filter",e)}try{let e=await fetch(n,s),t=new Headers(e.headers);return t.delete("www-authenticate"),t.set("X-Accel-Buffering","no"),new Response(e.body,{status:e.status,statusText:e.statusText,headers:t})}finally{clearTimeout(r)}}let T=new s.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/bytedance/[...path]/route",pathname:"/api/bytedance/[...path]",filename:"route",bundlePath:"app/api/bytedance/[...path]/route"},resolvedPagePath:"/Volumes/D/github/ChatGPT-Next-Web/app/api/bytedance/[...path]/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:E,staticGenerationAsyncStorage:P,serverHooks:_,headerHooks:A,staticGenerationBailout:B}=T,O="/api/bytedance/[...path]/route";function R(){return(0,i.XH)({serverHooks:_,staticGenerationAsyncStorage:P})}let N=r,S=n.a.wrap(T)}},e=>{var t=t=>e(e.s=t);e.O(0,[297,45,744],()=>t(1693));var a=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/bytedance/[...path]/route"]=a}]);
//# sourceMappingURL=route.js.map